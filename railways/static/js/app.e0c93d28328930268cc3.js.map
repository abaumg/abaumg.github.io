{"version":3,"sources":["webpack:///./src/lib/protobufExport.js","webpack:///./src/proto/place.js","webpack:///./src/components/LoadingIcon.vue?d151","webpack:///./src/components/LoadingIcon.vue","webpack:///./src/lib/Progress.js","webpack:///./src/lib/request.js","webpack:///./src/lib/postData.js","webpack:///./src/lib/BoundingBox.js","webpack:///./src/lib/Grid.js","webpack:///./src/lib/findBoundaryByName.js","webpack:///./src/lib/Query.js","webpack:///./src/lib/appState.js","webpack:///./src/config.js","webpack:///./src/lib/LoadOptions.js","webpack:///src/components/FindPlace.vue","webpack:///./src/components/FindPlace.vue?c784","webpack:///./src/components/FindPlace.vue","webpack:///./src/components/clickOutside.js","webpack:///src/components/EditableLabel.vue","webpack:///./src/components/EditableLabel.vue?6c41","webpack:///./src/components/EditableLabel.vue","webpack:///src/components/ColorPicker.vue","webpack:///./src/components/ColorPicker.vue?2ebd","webpack:///./src/components/ColorPicker.vue","webpack:///./src/lib/bus.js","webpack:///./src/lib/GridLayer.js","webpack:///./src/lib/svgExport.js","webpack:///./src/lib/saveFile.js","webpack:///./src/lib/createScene.js","webpack:///./src/lib/getZazzleLink.js","webpack:///./src/createOverlayManager.js","webpack:///src/App.vue","webpack:///./src/App.vue?5a4c","webpack:///./src/App.vue","webpack:///./src/NoWebGL.vue?d991","webpack:///./src/NoWebGL.vue","webpack:///./src/main.js","webpack:///./src/lib/canvas2BlobPolyfill.js"],"names":["Pbf","require","place","module","exports","grid","nodes","ways","date","Date","toISOString","forEachElement","x","type","push","pbf","write","version","id","name","finish","read","end","readFields","_readField","tag","obj","readVarint","readString","node","pos","way","writeVarintField","writeStringField","i","length","writeMessage","lat","lon","readFloat","writeFloatField","readPackedVarint","writePackedVarint","LoadingIcon","render","_h","this","$createElement","_c","_self","staticClass","attrs","xmlns","viewBox","width","height","fill","opacity","d","_v","attributeName","from","to","dur","repeatCount","staticRenderFns","components_LoadingIcon","__webpack_require__","normalizeComponent","Progress","notify","classCallCheck_default","eventify","callback","Function","prototype","isCancelled","fire","progress","on","off","request","url","options","req","onCancel","cancelDownload","promise_default","a","resolve","reject","XMLHttpRequest","addEventListener","e","lengthComputable","loaded","total","percent","offCancel","status","response","responseType","JSON","parse","setTimeout","statusError","message","cancelled","open","method","headers","keys_default","forEach","key","setRequestHeader","send","body","abort","backends","BBox","minX","Infinity","minY","maxX","maxY","offset","xIn","yIn","undefined","Error","y","rect","addPoint","left","top","right","bottom","otherBBox","Grid","elements","bounds","BoundingBox","map_default","wayPointCount","isArea","projector","bboxString","newProjector","project","getProjector","leftTop","rightBottom","Math","abs","enter","exit","positions","element","nodeIds","get","last","index","next","q","geoMercator","center","cx","cy","scale","_ref","xyPoint","elementsOfOSMResponse","fromOSMResponse","setName","setId","gridInstance","set","cachedResults","findBoundaryByName","inputName","results","encodeURIComponent","then","extractBoundaries","map","row","areaId","bbox","osm_type","osm_id","boundingbox","parse_float_default","osmId","osmType","display_name","Query","boundedQuery","queryBounds","queryString","promise","loadOptions","getQueryTemplate","run","_this","parts","extendedQuery","geoTest","match","substr","geoType","collectAllNominatimQueries","lastProcessed","processNext","part","pickFirstBoundary","first","assign_default","ms","args","join","runAllNominmantimQueries","resolvedQueryString","data","postData","Content-type","serverIndex","fetchFrom","overpassUrl","catch","handleError","err","osmResponse","All","Building","Road","RoadBasic","RoadStrict","boundaries","queryState","createQueryState","useSearch","appState","isCacheEnabled","enableCache","unset","apply","arguments","unsetPlace","config","areaServer","getDefaultLineColor","tinycolor","getLabelColor","getBackgroundColor","LoadOptions","overrides","wayFilter","timeout","maxHeapByteSize","outputMethod","scene","rawOptions","result","protoLayer","layerDefinition","layers","queryLayerAll","queryLayer","getProtoLayer","layer","getGridProjector","protoQueryBounds","getQueryBounds","raw","getBounds","serializeBBox","FindPlace","components","enteredInput","hasValidArea","restoreStateFromQueryString","loading","lastCancel","suggestionsLoaded","boxInTheMiddle","stillLoading","error","hideInput","noRoads","clicked","showWarning","mainActionText","suggestions","watch","mounted","$refs","input","focus","beforeDestroy","clearInterval","notifyStillLoading","methods","onSubmit","cancelRequest","restoredState","pickSuggestion","getBugReportURL","title","toString","updateProgress","restartLoadingMonitor","round","formatNumber","retry","lastSuggestion","suggestion","_this2","checkCache","useOSM","_this3","setInterval","_this4","generateNewProgressToken","arrayBuffer","Uint8Array","byteArray","lib_Grid","fromPBF","$emit","_this5","lib_Query","runFromOptions","lib_LoadOptions","hasRoads","setIsArea","setBBox","console","finally","progressToken","cancel","lib_Progress","is_finite_default","replace","parse_int_default","getCurrentAreaId","nodeAndBox","bboxStr","split","filter","parseBBox","getCurrentNodeAndBox","components_FindPlace","_vm","class","centered","_e","submit","$event","preventDefault","directives","rawName","value","expression","ref","placeholder","domProps","target","composing","href","click","_s","_m","_l","src_components_FindPlace","FindPlace_normalizeComponent","ssrContext","nodeList","ctx","startClick","seed","createDocumentHandler","el","binding","vnode","mouseup","mousedown","context","contains","popperElm","methodName","bindingFn","document","documentHandler","clickOutside","bind","update","unbind","len","splice","EditableLabel","props","ClickOutside","$el","receiveFocus","style","pointerEvents","looseFocus","blur","components_EditableLabel","printable","src_components_EditableLabel","EditableLabel_normalizeComponent","ColorPicker","sketch-picker","vue_color_min","Object","showPicker","colors","hex","colorValue","panelLeft","panelTop","computed","pickerType","isTransparent","btnStyle","background","backgroundImage","backgroundPosition","backgroundSize","_colorValue","r","g","b","val","oldVal","updateColorObject","newVal","triggerRect","triggerButton","getBoundingClientRect","desiredLeft","desiredTop","window","innerHeight","max","innerWidth","hide","changeColor","rgba","color","colorObj","tinycolor_default","toHexString","hsl","toHsl","hsv","toHsv","toRgb","getAlpha","h","s","l","v","components_ColorPicker","model","$$v","src_components_ColorPicker","ColorPicker_normalizeComponent","wgl","counter","GridLayer","_color","lines","dx","dy","hidden","_lineWidth","unsafeColor","toRatioColor","renderFrame","newValue","setLineWidth","bindToScene","_grid$getProjectedRec","getProjectedRect","initialSceneSize","warn","_transferTransform","WireCollection","allowColors","is3D","forEachWay","add","removeChild","buildLinesCollection","appendChild","log","translate","updateWorldTransform","c","svgExport","renderer","getRenderer","svgExportSettings","close","dpr","getPixelRatio","SVGSVGElement","svg","setAttribute","content","XMLSerializer","serializeToString","removeAttribute","label","text","insecurelyEscaped","leftOffset","paddingRight","bottomOffset","paddingBottom","fontSize","fontFamily","minLength","beforeWrite","path","pathLength","hypot_default","toSVG","getPrintableCanvas","cityCanvas","getCanvas","createElement","getContext","drawImage","all","collectPrintable","devicePixelRatio","image","Image","onload","src","btoa","save","font","fillStyle","textAlign","fillText","restore","drawTextLabel","querySelector","getFileName","extension","str","from_default","querySelectorAll","computedStyle","getComputedStyle","innerText","revokeLater","URL","revokeObjectURL","createScene","canvas","lastLineColor","t","bus","sceneAPI","setClearColor","camera","getCamera","setMoveSpeed","setRotationSpeed","PI","gl","getGL","blendFuncSeparate","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","ONE","slowDownZoom","backgroundColor","onKeyDown","onKeyUp","clear","destroy","getWGL","dispose","removeEventListener","lineColor","firstLayer","rawColor","load","queryFilter","setProjector","setGrid","saveToPNG","printableCanvas","fileName","toBlob","blob","createObjectURL","download","saveToSVG","extends_default","Blob","gridLayer","indexOf","getViewBox","setViewBox","shiftKey","setSpeed","imageUrl","productKinds","mug","generateZazzleLink","imageContent","toDataURL","form","FormData","append","success","kind","productCode","getZazzleLink","link","createOverlayManager","overlay","downEvent","clickedElement","time","now","handleMouseDown","handleMouseUp","handleTouchStart","passive","capture","handleTouchEnd","track","domElement","classList","removeOverlay","activeOverlays","deselect","onPointerDown","clientX","clientY","handleMouseMove","onPointerMove","onPointerUp","touches","touch","changedTouches","stopPropagation","handleTouchMove","foundElement","autoTrack","getRectangle","intersects","findTrackedElementUnderCursor","secondTimeClicking","bBox","isSingleClick","select","remove","App_ColorLayer","ColorLayer","App","placeFound","zazzleLink","generatingPreview","showSettings","settingsOpen","labelColor","labelColorRGBA","toRGBA","created","handleSceneTransform","syncBackground","syncLineColor","overlayManager","toggleSettings","onGridLoaded","visibility","updateLayers","lib_GridLayer","startOver","toRgbString","toPNGFile","toSVGFile","newLayers","lastLayer","getRoot","children","layerColor","fromRatio","newColor","setBackgroundColor","newBackground","updateBackground","zazzleMugPrint","recordOpenClick","ga","eventCategory","eventAction","eventLabel","selectortype_template_index_0_src_App","change","$set","overlay-manager","src_App","App_normalizeComponent","NoWebGL","alt","src_NoWebGL","NoWebGL_normalizeComponent","exDescription","filename","lineno","exFatal","Vue","productionTip","requireModule","d3Require","isWebGLEnabled","template","CanvasPrototype","HTMLCanvasElement","hasBlobConstructor","Boolean","hasArrayBufferViewSupport","size","BlobBuilder","WebKitBlobBuilder","MozBlobBuilder","MSBlobBuilder","dataURIPattern","dataURLtoBlob","atob","ArrayBuffer","dataURI","matches","mediaType","isBase64","dataString","byteString","intArray","bb","slice","decodeURIComponent","charCodeAt","getBlob","mozGetAsFile","quality","self","define","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_typeof___default"],"mappings":"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","file":"static/js/app.e0c93d28328930268cc3.js","sourcesContent":["var Pbf = require('pbf');\nvar place = require('../proto/place.js').place;\n\nmodule.exports = function protoBufExport(grid) {\n  let nodes = [];\n  let ways = [];\n  let date = (new Date()).toISOString();\n\n  grid.forEachElement(x => {\n    let elementType = 0;\n    if (x.type === 'node') {\n      nodes.push(x)\n    } else if (x.type === 'way') {\n      ways.push(x)\n    }\n  });\n\n  let pbf = new Pbf()\n  place.write({\n    version: 1,\n    id: grid.id,\n    date, \n    name: grid.name,\n    nodes, ways\n  }, pbf);\n  return pbf.finish();\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/protobufExport.js","'use strict'; // code generated by pbf v3.2.1\n\n// place ========================================\n\nvar place = exports.place = {};\n\nplace.read = function (pbf, end) {\n    return pbf.readFields(place._readField, {version: 0, name: \"\", date: \"\", id: \"\", nodes: [], ways: []}, end);\n};\nplace._readField = function (tag, obj, pbf) {\n    if (tag === 1) obj.version = pbf.readVarint();\n    else if (tag === 2) obj.name = pbf.readString();\n    else if (tag === 3) obj.date = pbf.readString();\n    else if (tag === 4) obj.id = pbf.readString();\n    else if (tag === 5) obj.nodes.push(place.node.read(pbf, pbf.readVarint() + pbf.pos));\n    else if (tag === 6) obj.ways.push(place.way.read(pbf, pbf.readVarint() + pbf.pos));\n};\nplace.write = function (obj, pbf) {\n    if (obj.version) pbf.writeVarintField(1, obj.version);\n    if (obj.name) pbf.writeStringField(2, obj.name);\n    if (obj.date) pbf.writeStringField(3, obj.date);\n    if (obj.id) pbf.writeStringField(4, obj.id);\n    if (obj.nodes) for (var i = 0; i < obj.nodes.length; i++) pbf.writeMessage(5, place.node.write, obj.nodes[i]);\n    if (obj.ways) for (i = 0; i < obj.ways.length; i++) pbf.writeMessage(6, place.way.write, obj.ways[i]);\n};\n\n// place.node ========================================\n\nplace.node = {};\n\nplace.node.read = function (pbf, end) {\n    return pbf.readFields(place.node._readField, {id: 0, lat: 0, lon: 0}, end);\n};\nplace.node._readField = function (tag, obj, pbf) {\n    if (tag === 1) obj.id = pbf.readVarint();\n    else if (tag === 2) obj.lat = pbf.readFloat();\n    else if (tag === 3) obj.lon = pbf.readFloat();\n};\nplace.node.write = function (obj, pbf) {\n    if (obj.id) pbf.writeVarintField(1, obj.id);\n    if (obj.lat) pbf.writeFloatField(2, obj.lat);\n    if (obj.lon) pbf.writeFloatField(3, obj.lon);\n};\n\n// place.way ========================================\n\nplace.way = {};\n\nplace.way.read = function (pbf, end) {\n    return pbf.readFields(place.way._readField, {nodes: []}, end);\n};\nplace.way._readField = function (tag, obj, pbf) {\n    if (tag === 1) pbf.readPackedVarint(obj.nodes);\n};\nplace.way.write = function (obj, pbf) {\n    if (obj.nodes) pbf.writePackedVarint(1, obj.nodes);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/proto/place.js","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('svg',{staticClass:\"loader\",attrs:{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 32 32\",\"width\":\"12\",\"height\":\"12\",\"fill\":\"black\"}},[_c('path',{attrs:{\"opacity\":\".25\",\"d\":\"M16 0 A16 16 0 0 0 16 32 A16 16 0 0 0 16 0 M16 4 A12 12 0 0 1 16 28 A12 12 0 0 1 16 4\"}}),_vm._v(\" \"),_c('path',{attrs:{\"d\":\"M16 0 A16 16 0 0 1 32 16 L28 16 A12 12 0 0 0 16 4z\"}},[_c('animateTransform',{attrs:{\"attributeName\":\"transform\",\"type\":\"rotate\",\"from\":\"0 16 16\",\"to\":\"360 16 16\",\"dur\":\"0.8s\",\"repeatCount\":\"indefinite\"}})],1)])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-5e3ceff5\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/LoadingIcon.vue\n// module id = null\n// module chunks = ","var normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nvar __vue_script__ = null\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-5e3ceff5\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./LoadingIcon.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = null\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/LoadingIcon.vue\n// module id = null\n// module chunks = ","import eventify from 'ngraph.events';\n\nexport default class Progress {\n  constructor(notify) {\n    eventify(this)\n    this.callback = notify || Function.prototype;\n  }\n\n  cancel() {\n    this.isCancelled = true;\n    this.fire('cancel');\n  }\n\n  notify(progress) {\n    if (!this.isCancelled) {\n      this.callback(progress);\n    }\n  }\n\n  onCancel(callback) {\n    this.on('cancel', callback, this);\n  }\n\n  offCancel(callback) {\n    this.off('cancel', callback);\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/Progress.js","import Progress from './Progress';\n\nexport default function request(url, options) {\n  if (!options) options = {};\n  let req;\n  let progress = options.progress || new Progress();\n  let isCancelled = false;\n  if (progress.on) {\n    progress.onCancel(cancelDownload);\n  }\n\n  return new Promise(download);\n\n  function cancelDownload() {\n    isCancelled = true;\n    if (req) {\n      req.abort();\n    }\n  }\n\n  function download(resolve, reject) {\n    req = new XMLHttpRequest();\n\n    if (typeof progress.notify === 'function') {\n      req.addEventListener('progress', updateProgress, false);\n    }\n\n    req.addEventListener('load', transferComplete, false);\n    req.addEventListener('error', transferFailed, false);\n    req.addEventListener('abort', transferCanceled, false);\n\n    req.open(options.method || 'GET', url);\n    if (options.responseType) {\n      req.responseType = options.responseType;\n    }\n\n    if (options.headers) {\n      Object.keys(options.headers).forEach(key => {\n        req.setRequestHeader(key, options.headers[key]);\n      });\n    }\n\n    if (options.method === 'POST') {\n      req.send(options.body);\n    } else {\n      req.send(null);\n    }\n\n    function updateProgress(e) {\n      if (e.lengthComputable) {\n        progress.notify({\n          loaded: e.loaded,\n          total: e.total,\n          percent: e.loaded / e.total,\n          lengthComputable: true\n        });\n      } else {\n        progress.notify({\n          loaded: e.loaded,\n          lengthComputable: false\n        });\n      }\n    }\n\n    function transferComplete() {\n      progress.offCancel(cancelDownload);\n\n      if (progress.isCancelled) return;\n\n      if (req.status !== 200) {\n        reject({\n          statusError: req.status,\n          message: `Unexpected status code ${req.status} when calling ${url}`\n        });\n        return;\n      }\n      var response = req.response;\n\n      if (options.responseType === 'json' && typeof response === 'string') {\n        // IE\n        response = JSON.parse(response);\n      }\n\n      setTimeout(() => resolve(response), 0);\n    }\n\n    function transferFailed() {\n      reject(`Failed to download ${url}`);\n    }\n\n    function transferCanceled() {\n      reject({\n        cancelled: true,\n        message: `Cancelled download of ${url}`\n      });\n    }\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/request.js","import request from './request';\nimport Progress from './Progress';\n\nlet backends = [\n  'https://overpass.kumi.systems/api/interpreter',\n  'https://overpass-api.de/api/interpreter',\n  'https://overpass.openstreetmap.ru/cgi/interpreter'\n]\n\nexport default function postData(data, progress) {\n  progress = progress || new Progress();\n  const postData = {\n    method: 'POST',\n    responseType: 'json',\n    progress,\n    headers: {\n      'Content-type': 'application/x-www-form-urlencoded; charset=UTF-8'\n    },\n    body: 'data=' + encodeURIComponent(data),\n  };\n\n  let serverIndex = 0;\n\n  return fetchFrom(backends[serverIndex]);\n\n  function fetchFrom(overpassUrl) {\n    return request(overpassUrl, postData, 'POST')\n      .catch(handleError);\n  }\n\n  function handleError(err) {\n    if (err.cancelled) throw err;\n\n    if (serverIndex >= backends.length - 1) {\n      // we can't do much anymore\n      throw err;\n    } \n\n    if (err.statusError) {\n      progress.notify({\n        loaded: -1\n      });\n    }\n\n    serverIndex += 1;\n    return fetchFrom(backends[serverIndex])\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/postData.js","export default class BBox {\n  constructor() {\n    this.minX = Infinity;\n    this.minY = Infinity;\n    this.maxX = -Infinity;\n    this.maxY = -Infinity;\n  }\n\n  growBy(offset) {\n    this.minX -= offset;\n    this.minY -= offset;\n    this.maxX += offset;\n    this.maxY += offset;\n  }\n\n  get left() {\n    return this.minX;\n  }\n\n  get top() {\n    return this.minY;\n  }\n\n  get right() {\n    return this.maxX;\n  }\n\n  get bottom() {\n    return this.maxY;\n  }\n\n  get width() {\n    return this.maxX - this.minX;\n  }\n\n  get height() {\n    return this.maxY - this.minY;\n  }\n\n  get cx() {\n    return (this.minX + this.maxX)/2;\n  }\n\n  get cy() {\n    return (this.minY + this.maxY)/2;\n  }\n\n  addPoint(xIn, yIn) {\n    if (xIn === undefined) throw new Error('Point is not defined');\n    let x = xIn;\n    let y = yIn;\n    if (y === undefined) {\n      // xIn is a point object\n      x = xIn.x;\n      y = xIn.y;\n    }\n\n    if (x < this.minX) this.minX = x;\n    if (x > this.maxX) this.maxX = x;\n    if (y < this.minY) this.minY = y;\n    if (y > this.maxY) this.maxY = y;\n  }\n\n  addRect(rect) {\n    if (!rect) throw new Error('rect is not defined');\n    this.addPoint(rect.left, rect.top);\n    this.addPoint(rect.right, rect.top);\n    this.addPoint(rect.left, rect.bottom);\n    this.addPoint(rect.right, rect.bottom);\n  }\n\n  merge(otherBBox) {\n    if (otherBBox.minX < this.minX) this.minX = otherBBox.minX;\n    if (otherBBox.minY < this.minY) this.minY = otherBBox.minY;\n    if (otherBBox.maxX > this.maxX) this.maxX = otherBBox.maxX;\n    if (otherBBox.maxY > this.maxY) this.maxY = otherBBox.maxY;\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/BoundingBox.js","import BoundingBox from './BoundingBox';\nimport {geoMercator} from 'd3-geo';\n\n/**\n * All roads in the area\n */\nexport default class Grid {\n  constructor() {\n    this.elements = [];\n    this.bounds = new BoundingBox();\n    this.nodes = new Map();\n    this.wayPointCount = 0;\n    this.id = 0;\n    this.name = '';\n    this.isArea = true;\n    this.projector = undefined; \n  }\n\n  setName(name) {\n    this.name = name;\n  }\n\n  setId(id) {\n    this.id = id;\n  }\n\n  setIsArea(isArea) {\n    this.isArea = isArea;\n  }\n\n  setBBox(bboxString) {\n    this.bboxString = bboxString;\n  }\n\n  hasRoads() {\n    return this.wayPointCount > 0;\n  }\n\n  setProjector(newProjector) {\n    this.projector = newProjector;\n  }\n\n  static fromPBF(pbf) {\n    if (pbf.version !== 1) throw new Error('Unknown version ' + pbf.version);\n    let elementsOfOSMResponse = [];\n    pbf.nodes.forEach(node => {\n      node.type = 'node';\n      elementsOfOSMResponse.push(node)\n    });\n    pbf.ways.forEach(way => {\n      way.type = 'way';\n      elementsOfOSMResponse.push(way);\n    });\n\n    const grid = Grid.fromOSMResponse(elementsOfOSMResponse);\n    grid.setName(pbf.name);\n    grid.setId(pbf.id);\n    return grid;\n  }\n\n  static fromOSMResponse(elementsOfOSMResponse) {\n    let gridInstance = new Grid();\n\n    let nodes = gridInstance.nodes;\n    let bounds = gridInstance.bounds;\n    let wayPointCount = 0;\n\n    // TODO: async?\n    elementsOfOSMResponse.forEach(element => {\n      if (element.type === 'node') {\n        nodes.set(element.id, element);\n        bounds.addPoint(element.lon, element.lat);\n      } else if (element.type === 'way') {\n        wayPointCount += element.nodes.length;\n      }\n    });\n\n    gridInstance.elements = elementsOfOSMResponse;\n    gridInstance.wayPointCount = wayPointCount;\n    return gridInstance;\n  }\n\n  getProjectedRect() {\n    let bounds = this.bounds;\n    let project = this.getProjector();\n    let leftTop = project({lon: bounds.left, lat: bounds.bottom});\n    let rightBottom = project({lon: bounds.right, lat: bounds.top});\n    let left = leftTop.x;\n    let top = leftTop.y;\n    let bottom = rightBottom.y\n    let right = rightBottom.x;\n    return {\n      left, top, right, bottom,\n      width: right - left, height: Math.abs(bottom - top)\n    }\n  }\n\n  forEachElement(callback) {\n    this.elements.forEach(callback);\n  }\n\n  forEachWay(callback, enter, exit) {\n    let positions = this.nodes;\n    let project = this.getProjector();\n    this.elements.forEach(element => {\n      if (element.type !== 'way') return;\n\n      let nodeIds = element.nodes;\n      let node = positions.get(nodeIds[0])\n      if (!node) return;\n\n      let last = project(node);\n      if (enter) enter(element);\n\n      for (let index = 1; index < nodeIds.length; ++index) {\n        node = positions.get(nodeIds[index])\n        if (!node) continue;\n        let next = project(node);\n\n        callback(last, next);\n\n        last = next;\n      }\n      if (exit) exit(element);\n    });\n  }\n\n  getProjector() {\n    let q = [0, 0]; // reuse to avoid GC.\n\n    if (!this.projector) {\n      this.projector = geoMercator();\n      this.projector\n        .center([this.bounds.cx, this.bounds.cy])\n        .scale(6371393); // Radius of Earth\n    }\n\n    let projector = this.projector;\n\n    return project;\n\n    function project({lon, lat}) {\n      q[0] = lon; q[1] = lat;\n\n      let xyPoint = projector(q);\n\n      return {\n        x: xyPoint[0],\n        y: -xyPoint[1]\n      };\n    }\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/Grid.js","import request from './request';\n\nlet cachedResults = new Map();\n\nexport default function findBoundaryByName(inputName) {\n  let results = cachedResults.get(inputName);\n  if (results) return Promise.resolve(results);\n\n  let name = encodeURIComponent(inputName);\n  return request(`https://nominatim.openstreetmap.org/search?format=json&q=${name}`, {responseType: 'json'})\n      .then(extractBoundaries)\n      .then(x => {\n        cachedResults.set(inputName, x);\n        return x;\n      });\n}\n\nfunction extractBoundaries(x) {\n  let areas = x.map(row => {\n      let areaId, bbox;\n      if (row.osm_type === 'relation') {\n        // By convention the area id can be calculated from an existing \n        // OSM way by adding 2400000000 to its OSM id, or in case of a \n        // relation by adding 3600000000 respectively. So we are adding this\n        // https://wiki.openstreetmap.org/wiki/Overpass_API/Overpass_QL#By_area_.28area.29\n        // Note: we may want to do another case for osm_type = 'way'. Need to check\n        // if it returns correct values.\n        areaId = row.osm_id + 36e8;\n      } else if (row.osm_type === 'way') {\n        areaId = row.osm_id + 24e8;\n      }\n      if (row.boundingbox) {\n        bbox = [\n          Number.parseFloat(row.boundingbox[0]),\n          Number.parseFloat(row.boundingbox[2]),\n          Number.parseFloat(row.boundingbox[1]),\n          Number.parseFloat(row.boundingbox[3]),\n        ];\n      }\n\n      return {\n        areaId,\n        bbox,\n        lat: row.lat,\n        lon: row.lon,\n        osmId: row.osm_id,\n        osmType: row.osm_type,\n        name: row.display_name,\n        type: row.type,\n      };\n    });\n\n  return areas;\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/findBoundaryByName.js","import postData from './postData';\nimport Grid from './Grid';\nimport findBoundaryByName from './findBoundaryByName';\n\nexport default class Query {\n  /**\n   * Every possible way\n   */\n  static All = 'way';\n\n  /**\n   * Every single building\n   */\n  static Building = 'way[building]';\n  /**\n   * This gets anything marked as a highway, which has its own pros and cons.\n   * See https://github.com/anvaka/city-roads/issues/20\n   */\n  static Road = 'way[highway]';\n\n  /**\n   * Reduced set of roads\n   */\n  static RoadBasic = 'way[railway~\"^(funicular|light_rail|miniature|monorail|narrow_gauge|rail|subway|tram|halt|platform|station)\"]';\n\n  /**\n   * More accurate representation of the roads by @RicoElectrico.\n   */\n  static RoadStrict = 'way[highway~\"^(((motorway|trunk|primary|secondary|tertiary)(_link)?)|unclassified|residential|living_street|pedestrian|service|track)$\"][area!=yes]';\n\n  static runFromOptions(loadOptions, progress) {\n    return loadOptions.getQueryTemplate().then(boundedQuery => {\n      let q = new Query(boundedQuery, progress);\n      return q.run();\n    });\n  }\n\n  constructor(boundedQuery, progress) {\n    this.queryBounds = boundedQuery.bounds;\n    this.queryString = boundedQuery.queryString;\n    this.progress = progress;\n    this.promise = null;\n  }\n\n  run() {\n    if (this.promise) {\n      return this.promise;\n    }\n    let parts = collectAllNominatimQueries(this.queryString);\n\n    this.promise = runAllNominmantimQueries(parts)\n      .then(resolvedQueryString => postData(resolvedQueryString, this.progress))\n      .then(osmResponse => {\n        let grid = Grid.fromOSMResponse(osmResponse.elements)\n        grid.queryBounds = this.queryBounds;\n        return grid;\n      });\n\n    return this.promise;\n  }\n}\n\nfunction runAllNominmantimQueries(parts) {\n  let lastProcessed = 0;\n\n  return processNext().then(concat);\n\n  function concat() {\n    return parts.map(part => {\n      if (typeof part === 'string') {\n        return part;\n      } \n      if (part.geoType === 'Area') return `area(${part.areaId})`;\n      if (part.geoType === 'Coords') return part.lat + ',' + part.lon;\n      if (part.geoType === 'Id') return `${part.osmType}(${part.osmId})`;\n      if (part.geoType === 'Bbox') return part.bbox.join(',');\n \n    }).join('');\n  }\n  \n  function processNext() {\n    if (lastProcessed >= parts.length) {\n      return Promise.resolve();\n    }\n    \n    let part = parts[lastProcessed];\n    lastProcessed += 1;\n    if (typeof part === 'string') return processNext();\n\n    return findBoundaryByName(part.name)\n      .then(pickFirstBoundary)\n      .then(first => {\n        if (!first) {\n          throw new Error('No areas found for request ' + part.name);\n        }\n        Object.assign(part, first);\n      })\n      .then(wait(1000)) // per nominatim agreement we are not allowed to issue more tan 1 request per second\n      .then(processNext);\n  }\n}\n\nfunction pickFirstBoundary(boundaries) {\n  if (boundaries.length > 0) {\n    return boundaries[0];\n  }\n}\n\nfunction collectAllNominatimQueries(extendedQuery) {\n  let geoTest = /{{geocode(.+?):(.+?)}}/;\n  let match;\n  let parts = [];\n  let lastIndex = 0;\n  while ((match = extendedQuery.match(geoTest))) {\n    parts.push(extendedQuery.substr(0, match.index));\n    parts.push({\n      geoType: match[1],\n      name: match[2]\n    });\n    extendedQuery = extendedQuery.substr(match.index + match[0].length)\n  }\n\n  parts.push(extendedQuery);\n\n  return parts;\n}\n\nfunction wait(ms) {\n  return function(args) {\n    return new Promise(resolve => {\n      setTimeout(() => resolve(args), ms);\n    });\n  }\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/Query.js","import createQueryState from 'query-state';\n\nconst queryState = createQueryState({}, {useSearch: true});\n\n/**\n * This is our base state. It just persists default information about\n * custom settings and integrates with query string.\n */\nexport default {\n  isCacheEnabled() {\n    return queryState.get('cache') != 0;\n  },\n  enableCache() {\n    return queryState.unset('cache');\n  },\n  get() {\n    return queryState.get.apply(queryState, arguments);\n  },\n  set() {\n    return queryState.set.apply(queryState, arguments);\n  },\n  unset() {\n    return queryState.unset.apply(queryState, arguments);\n  },\n\n  unsetPlace() {\n    queryState.unset('areaId');\n    queryState.unset('osm_id');\n    queryState.unset('bbox');\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/appState.js","import tinycolor from 'tinycolor2';\n\nexport default {\n  /**\n   * This is our caching backend\n   */\n  // This used to work, but seems like GitHub no longer allows large website hosting:\n  //areaServer: 'https://anvaka.github.io/index-large-cities/data',\n  //areaServer: 'http://localhost:8085', // This is un-commented when I develop cache locally\n  // So, using S3\n  areaServer: 'https://city-roads.s3-us-west-2.amazonaws.com/nov-02-2020',\n\n  getDefaultLineColor() {\n    return tinycolor('rgba(26, 26, 26, 0.8)');\n  },\n  getLabelColor() {\n    return tinycolor('#161616');\n  },\n\n  getBackgroundColor() {\n    return tinycolor('#F7F2E8');\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/config.js","import findBoundaryByName from \"./findBoundaryByName\";\n\n/**\n * For console API we allow a lot of flexibility to fetch data\n * This component normalizes input arguments and turns them into unified\n * options object\n */\n\nexport default class LoadOptions {\n  static parse(scene, wayFilter, rawOptions) {\n    let result = new LoadOptions();\n    if (typeof rawOptions === 'string') {\n      result.place = rawOptions;\n    }\n\n    if (wayFilter) {\n      result.wayFilter = wayFilter;\n    }\n\n    if (!rawOptions) return result;\n\n    Object.assign(result, rawOptions);\n\n    let protoLayer = getProtoLayer(scene, rawOptions.layer);\n    if (protoLayer) {\n      result.projector = protoLayer.getGridProjector();\n      let protoQueryBounds = protoLayer.getQueryBounds();\n      if (protoQueryBounds && !result.place && !result.areaId && !result.bbox) {\n        // use bounds of the parent layer unless we have our own override.\n        result.place = protoQueryBounds.place;\n        result.areaId = protoQueryBounds.areaId;\n        result.bbox = protoQueryBounds.bbox;\n      }\n    }\n\n    if (rawOptions.projector) {\n      // user defined projection. See https://github.com/d3/d3-geo for the projector reference:\n      result.projector = projector;\n    }\n\n    return result;\n  }\n\n  constructor(overrides) {\n    /**\n    * Query that should be translated to area id by nominatim;\n    */\n    this.place = undefined;\n\n    /**\n    * Which projector should be used to map lon/lat to layer's x/y\n    */\n    this.projector = undefined;\n    this.wayFilter = undefined;\n    this.timeout = 900;\n    this.maxHeapByteSize = 1073741824;\n    this.outputMethod = 'skel'; // body\n    Object.assign(this, overrides);\n  }\n\n  getQueryTemplate() {\n    if (this.raw) {\n      // I assume you know what you are doing.\n      return Promise.resolve({\n        queryString: this.raw\n      });\n    }\n\n    if (!this.wayFilter) {\n      throw new Error('Way filter is required');\n    }\n\n    return this.getBounds()\n      .then(bounds => {\n        let queryString;\n        if (bounds.areaId) {\n          queryString = `[timeout:${this.timeout}][maxsize:${this.maxHeapByteSize}][out:json];\narea(${bounds.areaId});\n(._; )->.area;\n(${this.wayFilter}(area.area); node(w););\nout ${this.outputMethod};`;\n        } else if (bounds.bbox) {\n          let bbox = serializeBBox(bounds.bbox);\n          queryString = `[timeout:${this.timeout}][maxsize:${this.maxHeapByteSize}][bbox:${bbox}][out:json];\n(${this.wayFilter}; node(w););\nout ${this.outputMethod};`;\n        }\n\n        return {\n          bounds,\n          queryString\n        }\n      });\n  }\n\n  getBounds() {\n    if (this.place) {\n      return findBoundaryByName(this.place).then(x => x && x[0]);\n    }\n    if (this.areaId) {\n      return Promise.resolve({ areaId: this.areaId });\n    }\n    if (this.bbox) {\n      return Promise.resolve({ bbox: this.bbox });\n    }\n\n    throw new Error('Please specify bounding area for the query (place|areaId|bbox)');\n  }\n}\n\nfunction getProtoLayer(scene, layerDefinition) {\n  if (layerDefinition === undefined) return;\n\n  if (typeof layerDefinition === 'number') {\n    let layers = scene.queryLayerAll();\n    return layers[layerDefinition];\n  } else if (typeof layerDefinition === 'string') {\n    return scene.queryLayer(layerDefinition);\n  } else {\n    // We assume it is a layer instance:\n    return layerDefinition;\n  }\n}\n\nfunction serializeBBox(bbox) {\n  return bbox && bbox.join(',');\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/LoadOptions.js","<template>\n<div class='find-place' :class='{centered: boxInTheMiddle }'>\n  <div v-if='boxInTheMiddle'>\n    <h3 class='site-header'>city roads</h3>\n    <p class='description'>This website renders every single road within a city</p>\n  </div>\n  <form v-on:submit.prevent=\"onSubmit\" class='search-box'>\n      <input class='query-input' v-model='enteredInput' type='text' placeholder='Enter a city name to start' ref='input'>\n      <a type='submit' class='search-submit' href='#' @click.prevent='onSubmit' v-if='enteredInput && !hideInput'>{{mainActionText}}</a>\n  </form>\n  <div v-if='showWarning' class='prompt message note shadow'>\n    Note: Large cities may require 200MB+ of data transfer and may need a powerful device to render.\n  </div>\n  <div class='results' v-if='!loading'>\n    <div v-if='suggestionsLoaded && suggestions.length' class='suggestions shadow'>\n      <div class='prompt message'>\n        <div>Select boundaries below to download all roads within</div>\n        <div class='note'>large cities may require 200MB+ of data transfer and a powerful device</div>\n      </div>\n      <ul>\n        <li v-for='(suggestion, index) in suggestions' :key=\"index\">\n          <a @click.prevent='pickSuggestion(suggestion)' class='suggestion'\n          href='#'>\n          <span>\n          {{suggestion.name}} <small>({{suggestion.type}})</small>\n          </span>\n          </a>\n        </li>\n      </ul>\n    </div>\n    <div v-if='suggestionsLoaded && !suggestions.length && !loading && !error' class='no-results message shadow'>\n      Didn't find matching cities. Try a different query?\n    </div>\n    <div v-if='noRoads' class='no-results message shadow'>\n      Didn't find any roads. Try a different query?\n    </div>\n  </div>\n  <div v-if='error' class='error message shadow'>\n    <div>Sorry, we were not able to download data from the OpenStreetMap.\n    It could be very busy at the moment processing other requests. <br/><br/> Please bookmark this website and <a href='#' @click.prevent=\"retry\">try again</a> later?</div>\n    <div class='error-links'>\n      <a href='https://twitter.com/anvaka/status/1218971717734789120' title='see what it supposed to do' target=\"_blank\">see how it should have worked</a>\n      <a :href='getBugReportURL(error)' :title='\"report error: \" + error' target='_blank'>report this bug</a>\n    </div>\n  </div>\n  <div v-if='loading' class='loading message shadow'>\n    <loading-icon></loading-icon>\n    <span>{{loading}}</span>\n    <a href=\"#\" @click.prevent='cancelRequest' class='cancel-request'>cancel</a>\n    <div class='load-padding' v-if='stillLoading > 0'>\n      Still loading...\n    </div>\n    <div class='load-padding' v-if='stillLoading > 1'>\n      Sorry it takes so long!\n    </div>\n  </div>\n</div>\n</template>\n\n<script>\nimport LoadingIcon from './LoadingIcon';\nimport Query from '../lib/Query';\nimport request from '../lib/request';\nimport findBoundaryByName from '../lib/findBoundaryByName';\nimport appState from '../lib/appState';\nimport Grid from '../lib/Grid';\nimport queryState from '../lib/appState';\nimport config from '../config';\nimport Progress from '../lib/Progress'\nimport LoadOptions from '../lib/LoadOptions';\n\nconst FIND_TEXT = 'Find City Bounds';\n\nexport default {\n  name: 'FindPlace',\n  components: {\n    LoadingIcon\n  },\n  data () {\n    const enteredInput = appState.get('q') || '';\n    let hasValidArea = restoreStateFromQueryString();\n\n    return {\n      enteredInput,\n      loading: null,\n      lastCancel: null,\n      suggestionsLoaded: false,\n      boxInTheMiddle: true,\n      stillLoading: 0,\n      error: null,\n      hideInput: false,\n      noRoads: false,\n      clicked: false,\n      showWarning: hasValidArea, \n      mainActionText: hasValidArea ? 'Download Area' : FIND_TEXT,\n      suggestions: []\n    }\n  },\n  watch: {\n    enteredInput() {\n      // As soon as they change it, we need not to download:\n      this.mainActionText = FIND_TEXT;\n      this.showWarning = false;\n      this.hideInput = false;\n      appState.unsetPlace();\n    }\n  },\n  mounted() {\n    this.$refs.input.focus();\n  },\n  beforeDestroy() {\n    if (this.lastCancel) this.lastCancel();\n    clearInterval(this.notifyStillLoading);\n  },\n  methods: {\n    onSubmit() {\n      queryState.set('q', this.enteredInput);\n      this.cancelRequest()\n      this.suggestions = [];\n      this.noRoads = false;\n      this.error = false;\n      this.showWarning = false;\n\n      const restoredState = restoreStateFromQueryString(this.enteredInput);\n      if (restoredState) {\n        this.pickSuggestion(restoredState);\n        return;\n      }\n\n      const query = encodeURIComponent(this.enteredInput);\n      this.loading = 'Searching cities that match your query...'\n      findBoundaryByName(this.enteredInput)\n        .then(suggestions => {\n          this.loading = null;\n          this.hideInput = suggestions && suggestions.length;\n          if (this.boxInTheMiddle) {\n            // let animation that moves input box proceed a bit\n            this.boxInTheMiddle = false; // This triggers transition\n            // wait for it and then set the suggestions:\n            setTimeout(() => {\n              this.suggestionsLoaded = true;\n              this.suggestions = suggestions;\n            }, 50)\n          } else {\n              this.suggestionsLoaded = true;\n              this.suggestions = suggestions; \n          }\n        });\n    },\n\n    getBugReportURL(error) {\n      let title = encodeURIComponent('OSM Error');\n      let body = '';\n      if (error) {\n        body = 'Hello, an error occurred on the website:\\n\\n```\\n' +\n          error.toString() + '\\n```\\n\\n Can you please help?';\n      }\n\n      return `https://github.com/anvaka/city-roads/issues/new?title=${title}&body=${encodeURIComponent(body)}`\n    },\n\n    updateProgress(status) {\n      this.stillLoading = 0;\n      clearInterval(this.notifyStillLoading);\n      if (status.loaded < 0) {\n        this.loading = 'Trying a different server'\n        this.restartLoadingMonitor();\n        return;\n      }\n      if (status.percent !== undefined) {\n        this.loading = 'Loaded ' + Math.round(100 * status.percent) + '% (' + formatNumber(status.loaded) + ' bytes)...';\n      } else {\n        this.loading = 'Loaded ' + formatNumber(status.loaded) + ' bytes...';\n      }\n    },\n\n    retry() {\n      if (this.lastSuggestion) {\n        this.pickSuggestion(this.lastSuggestion);\n      }\n    },\n\n    pickSuggestion(suggestion) {\n      this.lastSuggestion = suggestion;\n      this.error = false;\n      if (appState.isCacheEnabled() && suggestion.areaId) {\n        this.checkCache(suggestion)\n          .catch(error => {\n            if (error.cancelled) return; // no need to do anything. They've cancelled\n\n            // No Cache - fallback\n            return this.useOSM(suggestion);\n          });\n      } else {\n        // we don't have cache for nodes yet.\n        this.useOSM(suggestion);\n      }\n    },\n\n    restartLoadingMonitor() {\n      clearInterval(this.notifyStillLoading);\n      this.stillLoading = 0;\n      this.notifyStillLoading = setInterval(() => {\n        this.stillLoading++;\n      }, 10000);\n    },\n\n    checkCache(suggestion) {\n      this.loading = 'Checking cache...'\n      let areaId = suggestion.areaId;\n\n      return request(config.areaServer + '/' + areaId + '.pbf', {\n        progress: this.generateNewProgressToken(),\n        responseType: 'arraybuffer'\n      }).then(arrayBuffer => {\n        var byteArray = new Uint8Array(arrayBuffer);\n        return byteArray;\n      }).then(byteArray => {\n        var Pbf = require('pbf');\n        var place = require('../proto/place.js').place;\n        var pbf = new Pbf(byteArray);\n        var obj = place.read(pbf);\n        let grid = Grid.fromPBF(obj)\n        this.$emit('loaded', grid);\n      });\n    },\n\n    useOSM(suggestion) {\n      this.loading = 'Connecting to OpenStreetMap...'\n      \n      // it may take a while to load data. \n      this.restartLoadingMonitor();\n      Query.runFromOptions(new LoadOptions({\n        wayFilter: Query.Road,\n        areaId: suggestion.areaId,\n        bbox: suggestion.bbox\n      }), this.generateNewProgressToken())\n      .then(grid => {\n        this.loading = null;\n        if (!grid.hasRoads()) {\n          this.noRoads = true;\n        } else {\n          grid.setName(suggestion.name);\n          grid.setId(suggestion.areaId || suggestion.osm_id);\n          grid.setIsArea(suggestion.areaId); // osm nodes don't have area.\n          grid.setBBox(serializeBBox(suggestion.bbox));\n          this.$emit('loaded', grid);\n        }\n      }).catch(err => {\n        if (err.cancelled) {\n          this.loading = null;\n          return;\n        }\n        console.error(err);\n        this.error = err;\n        this.loading = null;\n        this.suggestions = [];\n      })\n      .finally(() => {\n        clearInterval(this.notifyStillLoading);\n        this.stillLoading = 0;\n      });\n    },\n\n    cancelRequest() {\n      if (this.progressToken) {\n        this.progressToken.cancel();\n        this.progressToken = null;\n        this.loading = false;\n      }\n    },\n\n    generateNewProgressToken() {\n      if (this.progressToken) {\n        this.progressToken.cancel();\n        this.progressToken = null;\n      }\n\n      this.progressToken = new Progress(this.updateProgress);\n      return this.progressToken;\n    }\n  }\n}\n\nfunction serializeBBox(bbox) {\n  return bbox && bbox.join(',');\n}\n\nfunction formatNumber(x) {\n  if (!Number.isFinite(x)) return 'N/A';\n  return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n}\n\nfunction restoreStateFromQueryString(name) {\n  let areaId = getCurrentAreaId();\n  if (areaId) {\n    return {name, areaId};\n  }\n\n  let nodeAndBox = getCurrentNodeAndBox();\n  if (nodeAndBox) {\n    return {\n      name,\n      osm_id: nodeAndBox.osm_id,\n      bbox: nodeAndBox.bbox\n    };\n  }\n}\n\nfunction getCurrentAreaId() {\n  let areaId = appState.get('areaId');\n  if (!Number.isFinite(Number.parseInt(areaId, 10))) {\n    areaId = null;\n  }\n  return areaId;\n}\n\nfunction getCurrentNodeAndBox() {\n  let osm_id = appState.get('osm_id');\n  if (!Number.isFinite(Number.parseInt(osm_id, 10))) return;\n\n  let bbox = parseBBox(appState.get('bbox'));\n  if (!bbox) return;\n\n  return { osm_id, bbox };\n}\n\nfunction parseBBox(bboxStr) {\n  if (!bboxStr) return null;\n\n  let bbox = bboxStr.split(',').map(x => Number.parseFloat(x)).filter(x => Number.isFinite(x));\n  return bbox.length === 4 ? bbox : null;\n}\n\n</script>\n\n<style lang=\"stylus\">\n@import('../vars.styl');\n.find-place  {\n  width: desktop-controls-width;\n}\n\nh3.site-header {\n  margin: 0;\n  font-weight: normal;\n  font-size: 32px;\n  text-align: center;\n}\n\ninput {\n  border: none;\n  flex: 1;\n  font-family: 'Avenir', Helvetica, Arial, sans-serif;\n  padding: 0;\n  color: #434343;\n  height: 100%;\n  font-size: 16px;\n  &:focus {\n    outline: none;\n  }\n}\n\n.search-box {\n  position: relative;\n  background-color: emphasis-background;\n  padding: 0 8px;\n  padding: 0 0 0 8px;\n\n  box-shadow: 0 2px 4px rgba(0,0,0,0.2), 0 -1px 0px rgba(0,0,0,0.02);\n  height: 48px;\n  display: flex;\n  font-size: 16px;\n  cursor: text;\n  a {\n    cursor: pointer;\n  }\n  span {\n    display: flex;\n    align-items: center;\n    flex-shrink: 0;\n  }\n}\n\n.prompt {\n  padding: 4px;\n  text-align: center;\n  font-size: 12px;\n}\n\n.search-submit {\n  padding: 0 8px;\n  align-items: center;\n  text-decoration: none;\n  display: flex;\n  flex-shrink: 0;\n  justify-content: center;\n  outline: none;\n  z-index: 1;\n  color: highlight-color\n  &:hover {\n    color: emphasis-background;\n    background: highlight-color;\n  }\n}\n\n.suggestion {\n  display: block\n  min-height: 64px\n  align-items: center;\n  border-bottom: 1px solid border-color\n  display: flex\n  padding: 0 10px;\n  text-decoration: none\n  color: highlight-color\n}\n\n.suggestions {\n  position: relative;\n  background: white\n  .note {\n    font-size: 10px;\n    font-style: italic;\n  }\n\n  ul {\n    list-style-type: none;\n    margin: 0;\n    padding: 0;\n    max-height: calc(100vh - 128px);\n    overflow-y: auto;\n    overflow-x: hidden;\n  }\n}\n\n.message,\n.loading {\n  padding: 4px 8px;\n  position: relative;\n}\n.shadow {\n  box-shadow: 0 2px 4px rgba(0,0,0,0.2)\n}\n\n.error {\n  overflow-x: auto;\n}\n\n.find-place {\n  position: absolute;\n  display: flex;\n  flex-direction: column;\n  top: 8px;\n  left: 50%;\n\n  transform: translateX(-50%) translateY(0);\n  transition-timing-function: ease-out;\n  transition-property: top left transform;\n  transition-duration: 0.2s;\n}\n\n.find-place.centered {\n  top: 50%;\n  left: 50%;\n  transform: translateX(-50%) translateY(-143px);\n}\n.load-padding {\n  padding-left: 16px;\n}\n.description {\n  padding: 8px;\n  margin: 0;\n  text-align: center;\n}\n\n.cancel-request {\n  position: absolute;\n  right: 4px;\n  top: 4px;\n  font-size: 12px;\n}\n.error-links {\n  display: flex;\n  justify-content: space-between;\n  font-size: 12px;\n}\n\n@media (max-width: small-screen) {\n  .find-place {\n    width: 100%;\n  }\n  .find-place.centered {\n    top: 8px;\n    left: 0;\n    transform: none;\n  }\n  .message {\n    font-size: 12px;\n  }\n  .prompt {\n    font-size: 12px;\n    .note {\n      font-size: 9px;\n    }\n  }\n}\n\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/FindPlace.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"find-place\",class:{centered: _vm.boxInTheMiddle }},[(_vm.boxInTheMiddle)?_c('div',[_c('h3',{staticClass:\"site-header\"},[_vm._v(\"city roads\")]),_vm._v(\" \"),_c('p',{staticClass:\"description\"},[_vm._v(\"This website renders every single road within a city\")])]):_vm._e(),_vm._v(\" \"),_c('form',{staticClass:\"search-box\",on:{\"submit\":function($event){$event.preventDefault();return _vm.onSubmit($event)}}},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.enteredInput),expression:\"enteredInput\"}],ref:\"input\",staticClass:\"query-input\",attrs:{\"type\":\"text\",\"placeholder\":\"Enter a city name to start\"},domProps:{\"value\":(_vm.enteredInput)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.enteredInput=$event.target.value}}}),_vm._v(\" \"),(_vm.enteredInput && !_vm.hideInput)?_c('a',{staticClass:\"search-submit\",attrs:{\"type\":\"submit\",\"href\":\"#\"},on:{\"click\":function($event){$event.preventDefault();return _vm.onSubmit($event)}}},[_vm._v(_vm._s(_vm.mainActionText))]):_vm._e()]),_vm._v(\" \"),(_vm.showWarning)?_c('div',{staticClass:\"prompt message note shadow\"},[_vm._v(\"\\n    Note: Large cities may require 200MB+ of data transfer and may need a powerful device to render.\\n  \")]):_vm._e(),_vm._v(\" \"),(!_vm.loading)?_c('div',{staticClass:\"results\"},[(_vm.suggestionsLoaded && _vm.suggestions.length)?_c('div',{staticClass:\"suggestions shadow\"},[_vm._m(0),_vm._v(\" \"),_c('ul',_vm._l((_vm.suggestions),function(suggestion,index){return _c('li',{key:index},[_c('a',{staticClass:\"suggestion\",attrs:{\"href\":\"#\"},on:{\"click\":function($event){$event.preventDefault();return _vm.pickSuggestion(suggestion)}}},[_c('span',[_vm._v(\"\\n          \"+_vm._s(suggestion.name)+\" \"),_c('small',[_vm._v(\"(\"+_vm._s(suggestion.type)+\")\")])])])])}),0)]):_vm._e(),_vm._v(\" \"),(_vm.suggestionsLoaded && !_vm.suggestions.length && !_vm.loading && !_vm.error)?_c('div',{staticClass:\"no-results message shadow\"},[_vm._v(\"\\n      Didn't find matching cities. Try a different query?\\n    \")]):_vm._e(),_vm._v(\" \"),(_vm.noRoads)?_c('div',{staticClass:\"no-results message shadow\"},[_vm._v(\"\\n      Didn't find any roads. Try a different query?\\n    \")]):_vm._e()]):_vm._e(),_vm._v(\" \"),(_vm.error)?_c('div',{staticClass:\"error message shadow\"},[_c('div',[_vm._v(\"Sorry, we were not able to download data from the OpenStreetMap.\\n    It could be very busy at the moment processing other requests. \"),_c('br'),_c('br'),_vm._v(\" Please bookmark this website and \"),_c('a',{attrs:{\"href\":\"#\"},on:{\"click\":function($event){$event.preventDefault();return _vm.retry($event)}}},[_vm._v(\"try again\")]),_vm._v(\" later?\")]),_vm._v(\" \"),_c('div',{staticClass:\"error-links\"},[_c('a',{attrs:{\"href\":\"https://twitter.com/anvaka/status/1218971717734789120\",\"title\":\"see what it supposed to do\",\"target\":\"_blank\"}},[_vm._v(\"see how it should have worked\")]),_vm._v(\" \"),_c('a',{attrs:{\"href\":_vm.getBugReportURL(_vm.error),\"title\":\"report error: \" + _vm.error,\"target\":\"_blank\"}},[_vm._v(\"report this bug\")])])]):_vm._e(),_vm._v(\" \"),(_vm.loading)?_c('div',{staticClass:\"loading message shadow\"},[_c('loading-icon'),_vm._v(\" \"),_c('span',[_vm._v(_vm._s(_vm.loading))]),_vm._v(\" \"),_c('a',{staticClass:\"cancel-request\",attrs:{\"href\":\"#\"},on:{\"click\":function($event){$event.preventDefault();return _vm.cancelRequest($event)}}},[_vm._v(\"cancel\")]),_vm._v(\" \"),(_vm.stillLoading > 0)?_c('div',{staticClass:\"load-padding\"},[_vm._v(\"\\n      Still loading...\\n    \")]):_vm._e(),_vm._v(\" \"),(_vm.stillLoading > 1)?_c('div',{staticClass:\"load-padding\"},[_vm._v(\"\\n      Sorry it takes so long!\\n    \")]):_vm._e()],1):_vm._e()])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"prompt message\"},[_c('div',[_vm._v(\"Select boundaries below to download all roads within\")]),_vm._v(\" \"),_c('div',{staticClass:\"note\"},[_vm._v(\"large cities may require 200MB+ of data transfer and a powerful device\")])])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-4d709138\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/FindPlace.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-4d709138\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!stylus-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./FindPlace.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./FindPlace.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./FindPlace.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-4d709138\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./FindPlace.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/FindPlace.vue\n// module id = null\n// module chunks = ","// Based on https://github.com/ElemeFE/element/blob/dev/src/utils/clickoutside.js\n// The MIT License (MIT), Copyright (c) 2016 ElemeFE\nconst nodeList = [];\nconst ctx = '@@clickoutsideContext';\n\nlet startClick;\nlet seed = 0;\n\ndocument.addEventListener('mousedown', e => (startClick = e), true);\ndocument.addEventListener('mouseup', e => {\n  nodeList.forEach(node => node[ctx].documentHandler(e, startClick));\n}, true);\n\n// Also hide when tapped outside.\ndocument.addEventListener('touchstart', e => {\n  startClick = e;\n}, true);\ndocument.addEventListener('touchend', e => {\n  nodeList.forEach(node => node[ctx].documentHandler(e, startClick));\n}, true);\n\nfunction createDocumentHandler(el, binding, vnode) {\n  return function(mouseup = {}, mousedown = {}) {\n    if (!vnode || !vnode.context ||\n      !mouseup.target || !mousedown.target ||\n      el.contains(mouseup.target) ||\n      el.contains(mousedown.target) ||\n      el === mouseup.target ||\n      (vnode.context.popperElm &&\n      (vnode.context.popperElm.contains(mouseup.target) ||\n      vnode.context.popperElm.contains(mousedown.target)))) return;\n\n    const methodName = el[ctx].methodName;\n    if (binding.expression && methodName && vnode.context[methodName]) {\n      vnode.context[methodName]();\n    } else {\n      el[ctx].bindingFn && el[ctx].bindingFn();\n    }\n  };\n}\n\nexport default {\n  bind(el, binding, vnode) {\n    nodeList.push(el);\n    const id = seed++;\n    el[ctx] = {\n      id,\n      documentHandler: createDocumentHandler(el, binding, vnode),\n      methodName: binding.expression,\n      bindingFn: binding.value\n    };\n  },\n\n  update(el, binding, vnode) {\n    el[ctx].documentHandler = createDocumentHandler(el, binding, vnode);\n    el[ctx].methodName = binding.expression;\n    el[ctx].bindingFn = binding.value;\n  },\n\n  unbind(el) {\n    let len = nodeList.length;\n\n    for (let i = 0; i < len; i++) {\n      if (nodeList[i][ctx].id === el[ctx].id) {\n        nodeList.splice(i, 1);\n        break;\n      }\n    }\n    delete el[ctx];\n  }\n};\n\n\n// WEBPACK FOOTER //\n// ./src/components/clickOutside.js","<template>\n  <div v-click-outside='looseFocus' class='can-drag'>\n    <div class='editable-label'>\n      <span :class='{printable}'>{{value}}</span>\n      <input\n        v-bind:value=\"value\"\n        v-on:input=\"$emit('input', $event.target.value)\"\n        ref='input'\n      >\n    </div>\n  </div>\n</template>\n<script>\nimport ClickOutside from './clickOutside.js'\n\nexport default {\n  name: 'EditableLabel',\n  props: ['value', 'printable', 'overlayManager'],\n  directives: { ClickOutside },\n  mounted() {\n    this.$el.receiveFocus = this.focus;\n    this.$el.style.pointerEvents = 'none';\n  },\n  methods: {\n    looseFocus() {\n      this.$refs.input.blur();\n    },\n    focus() {\n      this.$refs.input.focus();\n    }\n  }\n}\n</script>\n<style lang=\"stylus\">\n@import('../vars.styl');\n\n.editable-label {\n  position: relative;\n\n  span {\n    position: relative;\n    top: 0;\n    left: 0;\n    display: flex;\n    align-items : center;\n    font-family: labels-font;\n    white-space: pre;\n    padding: 8px;\n    border: 1px solid transparent;\n  }\n\n  input {\n    caret-color: primary-text;\n    color: transparent;\n    font-family: labels-font;\n    background: transparent;\n    display: flex;\n    align-items: center;\n    position: absolute;\n    overflow: hidden;\n    top: 0;\n    left: 0;\n    width: 100%;\n    padding: 8px;\n  }\n}\n  \n</style>\n\n\n// WEBPACK FOOTER //\n// src/components/EditableLabel.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{directives:[{name:\"click-outside\",rawName:\"v-click-outside\",value:(_vm.looseFocus),expression:\"looseFocus\"}],staticClass:\"can-drag\"},[_c('div',{staticClass:\"editable-label\"},[_c('span',{class:{printable: _vm.printable}},[_vm._v(_vm._s(_vm.value))]),_vm._v(\" \"),_c('input',{ref:\"input\",domProps:{\"value\":_vm.value},on:{\"input\":function($event){return _vm.$emit('input', $event.target.value)}}})])])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-8f936aaa\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/EditableLabel.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-8f936aaa\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!stylus-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./EditableLabel.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./EditableLabel.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./EditableLabel.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-8f936aaa\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./EditableLabel.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/EditableLabel.vue\n// module id = null\n// module chunks = ","\n<template>\n<div class='vue-colorpicker' @click='showPicker = true' v-click-outside='hide' >\n  <span class='vue-colorpicker-btn' :style='btnStyle' ref='triggerButton'></span>\n  <div class='vue-colorpicker-panel' v-show='showPicker' :style=\"{left: panelLeft, top: panelTop}\">\n    <component :is='pickerType' v-model='colors' @input='changeColor'></component>\n  </div>\n</div>\n</template>\n\n<script>\nimport tinycolor from 'tinycolor2'\nimport { Sketch } from 'vue-color'\nimport ClickOutside from './clickOutside.js'\n\nexport default {\n  name: 'vue-colorpicker',\n  components: {\n    'sketch-picker': Sketch,\n  },\n  directives: { ClickOutside },\n  props: {\n    value: {\n      type: Object,\n    },\n  },\n  data () {\n    return {\n      showPicker: false,\n      colors: {\n        hex: '#FFFFFF',\n        a: 1\n      },\n      colorValue: '#FFFFFF',\n      panelLeft: '0px',\n      panelTop: '0px'\n    }\n  },\n  computed: {\n    pickerType () {\n      return 'sketch-picker';\n    },\n    isTransparent () {\n      return this.colors.a === 0;\n    },\n    btnStyle () {\n      if (this.isTransparent) {\n        return {\n          background: '#eee',\n          backgroundImage: 'linear-gradient(45deg, rgba(0,0,0,.25) 25%, transparent 0, transparent 75%,rgba(0,0,0,.25)0), linear-gradient(45deg, rgba(0,0,0,.25)25%,transparent 0, transparent 75%,rgba(0,0,0,.25)0)',\n          backgroundPosition: '0 0, 11px 11px',\n          backgroundSize: '22px 22px'\n        }\n      }\n      let {r, g, b, a} = this.colorValue;\n      return {\n        background: `rgba(${r}, ${g}, ${b}, ${a})`\n      }\n    },\n  },\n  watch: {\n    value (val, oldVal) {\n      if (val !== oldVal) {\n        this.updateColorObject(val);\n      }\n    },\n    showPicker(newVal) {\n      if (!newVal) return;\n\n      const PICKER_WIDTH = 220;\n      const PANEL_HEIGHT = 320;\n      let triggerRect = this.$refs.triggerButton.getBoundingClientRect();\n      let desiredLeft = triggerRect.x;\n      let desiredTop = triggerRect.bottom;\n      if (triggerRect.y + PANEL_HEIGHT > window.innerHeight) {\n        desiredTop = Math.max(0, window.innerHeight - PANEL_HEIGHT);\n        desiredLeft += 36; // so that the selector button is still visible;\n      }\n      if (desiredLeft + PICKER_WIDTH > window.innerWidth) {\n        desiredLeft = Math.max(0, window.innerWidth - PICKER_WIDTH);\n      } \n      this.panelLeft = desiredLeft + 'px';\n      this.panelTop = desiredTop + 'px';\n    }\n  },\n\n  methods: {\n    hide () {\n      this.showPicker = false;\n    },\n    changeColor (data) {\n      this.colorValue = data.rgba;\n      this.$emit('input', this.colorValue)\n      this.$emit('change', this.colorValue)\n    },\n    updateColorObject (color) {\n      if (!color) return\n      const colorObj = tinycolor(color);\n      if (!color || color === 'transparent') {\n        this.colors = {\n          hex: '#FFFFFF',\n          hsl: { h: 0, s: 0, l: 1, a: 0 },\n          hsv: { h: 0, s: 0, v: 1, a: 0 },\n          rgba: { r: 255, g: 255, b: 255, a: 0 },\n          a: 0\n        };\n      } else {\n        this.colors = {\n          hex: colorObj.toHexString(),\n          hsl: colorObj.toHsl(),\n          hsv: colorObj.toHsv(),\n          rgba: colorObj.toRgb(),\n          a: colorObj.getAlpha()\n        };\n      }\n      this.colorValue = this.colors.rgba;\n    }\n  },\n  mounted () {\n    this.updateColorObject(this.value)\n  }\n}\n</script>\n\n<style lang=\"stylus\" scoped>\n.vue-colorpicker {\n  display: inline-block;\n  box-sizing: border-box;\n  font-size: 0;\n  cursor: pointer;\n  &-btn {\n    display: inline-block;\n    width: 30px;\n    height: 22px;\n    border: 1px solid #666;\n    background: #FFFFFF;\n  }\n\n  .vue-colorpicker-panel {\n    position: absolute;\n    z-index: 1;\n  }\n}\n</style>\n\n\n// WEBPACK FOOTER //\n// src/components/ColorPicker.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{directives:[{name:\"click-outside\",rawName:\"v-click-outside\",value:(_vm.hide),expression:\"hide\"}],staticClass:\"vue-colorpicker\",on:{\"click\":function($event){_vm.showPicker = true}}},[_c('span',{ref:\"triggerButton\",staticClass:\"vue-colorpicker-btn\",style:(_vm.btnStyle)}),_vm._v(\" \"),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.showPicker),expression:\"showPicker\"}],staticClass:\"vue-colorpicker-panel\",style:({left: _vm.panelLeft, top: _vm.panelTop})},[_c(_vm.pickerType,{tag:\"component\",on:{\"input\":_vm.changeColor},model:{value:(_vm.colors),callback:function ($$v) {_vm.colors=$$v},expression:\"colors\"}})],1)])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-a5fc1b7c\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/ColorPicker.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-a5fc1b7c\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!stylus-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./ColorPicker.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./ColorPicker.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./ColorPicker.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-a5fc1b7c\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./ColorPicker.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-a5fc1b7c\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/ColorPicker.vue\n// module id = null\n// module chunks = ","import eventify from 'ngraph.events';\n\n// we are going to use this as a global message bus inside the app.\nexport default eventify({});\n\n\n// WEBPACK FOOTER //\n// ./src/lib/bus.js","import config from '../config';\nimport tinycolor from 'tinycolor2';\n\nconst wgl = require('w-gl');\nlet counter = 0;\n\nexport default class GridLayer {\n  get color() {\n    return this._color;\n  }\n\n  set color(unsafeColor) {\n    let color = tinycolor(unsafeColor);\n    this._color = color;\n    if (this.lines) {\n      this.lines.color = toRatioColor(color.toRgb());\n    }\n    if (this.scene) {\n      this.scene.renderFrame();\n    }\n  }\n\n  get lineWidth() {\n    return this._lineWidth;\n  }\n\n  set lineWidth(newValue) {\n    this._lineWidth = newValue;\n    if (!this.lines || !this.scene) return;\n\n    this.lines.setLineWidth(newValue);\n  }\n\n  constructor() {\n    this._color = config.getDefaultLineColor();\n    this.grid = null;\n    this.lines = null;\n    this.scene = null;\n    this.dx = 0;\n    this.dy = 0;\n    this.scale = 1;\n    this.hidden = false;\n    this.id = 'paths_' + counter;\n    this._lineWidth = 1;\n    counter += 1;\n  }\n\n  getGridProjector() {\n    if (this.grid) return this.grid.projector;\n  }\n\n  getQueryBounds() {\n    const {grid} = this;\n    if (grid) {\n      if (grid.queryBounds) return grid.queryBounds;\n      if (grid.isArea) return {\n        areaId: grid.id\n      };\n    }\n  }\n\n  setGrid(grid) {\n    this.grid = grid;\n    if (this.scene) {\n      this.bindToScene(this.scene);\n    }\n  }\n\n  getViewBox() {\n    if (!this.grid) return null;\n\n    let {width, height} = this.grid.getProjectedRect();\n    let initialSceneSize = Math.max(width, height) / 4;\n    return {\n      left:  -initialSceneSize,\n      top:    initialSceneSize,\n      right:  initialSceneSize,\n      bottom: -initialSceneSize,\n    };\n  }\n\n  moveTo(x, y = 0) {\n    console.warn('Please use moveBy() instead. The moveTo() is under construction');\n    // this.dx = x;\n    // this.dy = y;\n\n    // this._transferTransform();\n  }\n\n  moveBy(dx, dy = 0) {\n    this.dx = dx;\n    this.dy = dy;\n\n    this._transferTransform();\n  }\n\n  buildLinesCollection() {\n    if (this.lines) return this.lines;\n\n    let grid = this.grid;\n    let lines = new wgl.WireCollection(grid.wayPointCount, {\n      width: this._lineWidth,\n      allowColors: false,\n      is3D: false\n    });\n    grid.forEachWay(function(from, to) {\n      lines.add({from, to});\n    });\n    let color = tinycolor(this._color).toRgb();\n    lines.color = toRatioColor(color);\n    lines.id = this.id;\n\n    this.lines = lines;\n  }\n\n  destroy() {\n    if (!this.scene || !this.lines) return;\n\n    // TODO: This should remove the grid layer too. Need to clean up how\n    // scene interacts with grid layers.\n    this.scene.removeChild(this.lines);\n  }\n\n  bindToScene(scene) {\n    if (this.scene && this.lines) {\n      console.error('You seem to be adding this layer twice...')\n    }\n\n    this.scene = scene;\n    if (!this.grid) return;\n\n    this.buildLinesCollection();\n\n    if (this.hidden) return;\n    this.scene.appendChild(this.lines);\n  }\n\n  hide() {\n    if (this.hidden) return;\n    this.hidden = true;\n    if (!this.scene || !this.grid) return;\n\n    this.scene.removeChild(this.lines);\n  }\n\n  show() {\n    if (!this.hidden) return;\n    this.hidden = false;\n    if (!this.scene || !this.grid) {\n      console.log('Layer will be shown when grid is available');\n      return;\n    }\n\n    this.scene.appendChild(this.lines);\n  }\n\n  _transferTransform() {\n    if (!this.lines) return;\n\n    this.lines.translate([this.dx, this.dy, 0]);\n    this.lines.updateWorldTransform(true);\n    if (this.scene) {\n      this.scene.renderFrame(true);\n    }\n  }\n}\n\nfunction toRatioColor(c) {\n  return {r: c.r/0xff, g: c.g/0xff, b: c.b/0xff, a: c.a}\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/GridLayer.js","let place = require('../proto/place.js').place;\nconst wgl = require('w-gl');\n\nexport default function svgExport(scene, options) {\n  const renderer = scene.getRenderer();\n  const svgExportSettings = {\n    open() {\n      return `<!-- Generator: https://github.com/anvaka/city-roads\nData © OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\n-->`;\n    },\n    close() {\n      return getPrintableElements();\n    }\n  };\n\n  if (options.minLength) {\n    svgExportSettings.beforeWrite = path => {\n      let pathLength = 0;\n      for (let i = 1; i < path.length; ++i) {\n        pathLength += Math.hypot(path[i].x - path[i - 1].x, path[i].y - path[i - 1].y);\n        if (pathLength > options.minLength) return true;\n      }\n      return pathLength > options.minLength;\n    }\n  }\n  svgExportSettings.round = options.round;\n\n  const svg = wgl.toSVG(renderer, svgExportSettings);\n\n  return svg;\n\n  function getPrintableElements() {\n    let dpr = renderer.getPixelRatio();\n\n    return options.printable.map(el => {\n      if (el.element instanceof SVGSVGElement) {\n        let bounds = el.bounds;\n        let x = bounds.left * dpr;\n        let y = bounds.top * dpr;\n        let svg = el.element;\n        svg.setAttribute('x', bounds.left * dpr);\n        svg.setAttribute('y', bounds.top * dpr);\n        svg.setAttribute('width', bounds.width * dpr);\n        svg.setAttribute('height', bounds.height * dpr);\n        let content = new XMLSerializer().serializeToString(el.element);\n        svg.removeAttribute('x');\n        svg.removeAttribute('y');\n        svg.removeAttribute('width');\n        svg.removeAttribute('height');\n        return content;\n      } else {\n        let label = el;\n        if (!label.text) return;\n        let insecurelyEscaped = label.text\n          .replace(/&/g, '&amp;')\n          .replace(/</g, '&lt;')\n          .replace(/>/g, '&gt;')\n        \n        // Note: this is not 100% accurate, might need to be fixed eventually\n        let bounds = label.bounds;\n        let leftOffset = (bounds.right - label.paddingRight) * dpr;\n        let bottomOffset = (bounds.bottom - label.paddingBottom) * dpr;\n        let fontSize = label.fontSize * dpr;\n\n        let fontFamily = label.fontFamily.replace(/\"/g, '\\'');\n        return `<text text-anchor=\"end\" x=\"${leftOffset}\" y=\"${bottomOffset}\" fill=\"${label.color}\" font-family=\"${fontFamily}\" font-size=\"${fontSize}\">${insecurelyEscaped}</text>`\n      }\n    }).filter(x => x).join('\\n')\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/svgExport.js","import protobufExport from './protobufExport';\nimport svgExport from './svgExport';\n\nexport function toSVG(scene, options) {\n  options = options || {};\n  let svg = svgExport(scene, { \n    printable: collectPrintable(),\n    ...options\n  });\n  let blob = new Blob([svg], {type: \"image/svg+xml\"});\n  let url = window.URL.createObjectURL(blob);\n  let fileName = getFileName(options.name, '.svg');\n  // For some reason, safari doesn't like when download happens on the same\n  // event loop cycle. Pushing it to the next one.\n  setTimeout(() => {\n    let a = document.createElement(\"a\");\n    a.href = url;\n    a.download = fileName;\n    a.click();\n    revokeLater(url);\n  }, 30)\n}\n\nexport function toPNG(scene, options) {\n  options = options || {};\n\n  getPrintableCanvas(scene).then((printableCanvas) => {\n    let fileName = getFileName(options.name, '.png');\n\n    printableCanvas.toBlob(function(blob) {\n      let url = window.URL.createObjectURL(blob);\n      let a = document.createElement(\"a\");\n      a.href = url;\n      a.download = fileName;\n      a.click();\n      revokeLater(url);\n    }, 'image/png')\n  })\n}\n\nexport function getPrintableCanvas(scene) {\n  let cityCanvas = getCanvas();\n  let width = cityCanvas.width;\n  let height = cityCanvas.height;\n\n  let printable = document.createElement('canvas');\n  let ctx = printable.getContext('2d');\n  printable.width = width;\n  printable.height = height;\n  scene.render();\n  ctx.drawImage(cityCanvas, 0, 0, cityCanvas.width, cityCanvas.height, 0, 0, width, height);\n\n  return Promise.all(collectPrintable().map(label => drawTextLabel(label, ctx))).then(() => {\n    return printable;\n  });\n}\n\nexport function getCanvas() {\n  return document.querySelector('#canvas')\n}\n\nfunction getFileName(name, extension) {\n  let fileName = escapeFileName(name || new Date().toISOString());\n  return fileName + (extension || '');\n}\n\nfunction escapeFileName(str) {\n  if (!str) return '';\n\n  return str.replace(/[#%&{}\\\\/?*><$!'\":@+`|=]/g, '_');\n}\n\n\nfunction drawTextLabel(element, ctx) {\n  if (!element) return Promise.resolve();\n\n  return new Promise((resolve, reject) => {\n    let dpr = window.devicePixelRatio || 1;\n\n    if (element.element instanceof SVGSVGElement) {\n      let svg = element.element;\n      let rect = element.bounds;\n      let image = new Image();\n      image.width = rect.width * dpr;\n      image.height = rect.height * dpr;\n      image.onload = () => {\n        ctx.drawImage(image, rect.left * dpr, rect.top * dpr, image.width, image.height);\n        svg.removeAttribute('width');\n        svg.removeAttribute('height');\n        resolve();\n      };\n\n      // Need to set width, otherwise firefox doesn't work: https://stackoverflow.com/questions/28690643/firefox-error-rendering-an-svg-image-to-html5-canvas-with-drawimage\n      svg.setAttribute('width', image.width);\n      svg.setAttribute('height', image.height);\n      image.src = 'data:image/svg+xml;base64,' + btoa(new XMLSerializer().serializeToString(svg));\n    } else {\n      ctx.save();\n\n      ctx.font = dpr * element.fontSize + 'px ' + element.fontFamily;\n      ctx.fillStyle = element.color;\n      ctx.textAlign = 'end'\n      ctx.fillText(\n        element.text, \n        (element.bounds.right - element.paddingRight) * dpr, \n        (element.bounds.bottom - element.paddingBottom) * dpr\n      )\n      ctx.restore();\n      resolve();\n    }\n  });\n}\n\nfunction collectPrintable() {\n  return Array.from(document.querySelectorAll('.printable')).map(element => {\n    let computedStyle = window.getComputedStyle(element);\n    let bounds = element.getBoundingClientRect();\n    let fontSize = Number.parseInt(computedStyle.fontSize, 10);\n    let paddingRight = Number.parseInt(computedStyle.paddingRight, 10);\n    // TODO: I don't know why I need to multiply by 2, it's just\n    // not aligned right if I don't multiply. Need to figure out this.\n    let paddingBottom = Number.parseInt(computedStyle.paddingBottom, 10) * 2;\n\n    return {\n      text: element.innerText,\n      bounds,\n      fontSize,\n      paddingBottom,\n      paddingRight,\n      color: computedStyle.color,\n      fontFamily: computedStyle.fontFamily,\n      fill: computedStyle.color,\n      element\n    }\n  });\n}\n\nfunction revokeLater(url) {\n  // In iOS immediately revoked URLs cause \"WebKitBlobResource error 1.\" error\n  // Setting a timeout to revoke URL in the future fixes the error:\n  setTimeout(() => {\n    window.URL.revokeObjectURL(url);\n  }, 45000);\n}\n\nfunction toProtobuf() {\n  if (!lastGrid) return;\n\n  let arrayBuffer = protobufExport(lastGrid);\n  let blob = new Blob([arrayBuffer.buffer], {type: \"application/octet-stream\"});\n  let url = window.URL.createObjectURL(blob);\n  let a = document.createElement(\"a\");\n  a.href = url;\n  a.download = lastGrid.id + '.pbf';\n  a.click();\n  revokeLater(url);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/saveFile.js","import bus from './bus';\nimport GridLayer from './GridLayer';\nimport Query from './Query';\nimport LoadOptions from './LoadOptions.js';\nimport config from '../config';\nimport tinycolor from 'tinycolor2';\nimport eventify from 'ngraph.events';\nimport {toSVG, toPNG} from './saveFile';\n\nconst wgl = require('w-gl');\n/**\n * This file is responsible for rendering of the grid. It uses my silly 2d webgl\n * renderer which is not very well documented, neither popular, yet it is very\n * fast.\n */\n\nexport default function createScene(canvas) {\n  let scene = wgl.createScene(canvas);\n  let lastLineColor = config.getDefaultLineColor();\n  scene.on('transform', triggerTransform);\n  scene.on('append-child', triggerAdd);\n  scene.on('remove-child', triggerRemove);\n\n  scene.setClearColor(0xf7/0xff, 0xf2/0xff, 0xe8/0xff, 1.0);\n  let camera = scene.getCamera();\n  if (camera.setMoveSpeed) {\n    camera.setMoveSpeed(200);\n    camera.setRotationSpeed(Math.PI/500);\n  }\n\n  let gl = scene.getGL();\n  gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n\n  let slowDownZoom = false;\n  let layers = [];\n  let backgroundColor = config.getBackgroundColor();\n\n  listenToEvents();\n\n  let sceneAPI = {\n    /**\n     * Requests the scene to perform immediate re-render\n     */\n    render() {\n      scene.renderFrame(true);\n    },\n\n    /**\n     * Removes all layers in the scene\n     */\n    clear() {\n      layers.forEach(layer => layer.destroy());\n      layers = [];\n      scene.clear();\n    },\n\n    /**\n     * Returns all layers in the scene.\n     */\n    queryLayerAll,\n\n    /**\n     * Same as `queryLayerAll(filter)` but returns the first found\n     * match. If no matches found - returns undefined.\n     */\n    queryLayer,\n    \n    getRenderer() {\n      return scene;\n    },\n\n    getWGL() {\n      // Let the plugins use the same version of wgl library\n      return wgl;\n    },\n\n    version() {\n      return '0.0.2'; // here be dragons\n    },\n\n    /**\n     * Destroys the scene, cleans up all resources.\n     */\n    dispose() {\n      scene.clear();\n      scene.dispose();\n      sceneAPI.fire('dispose', sceneAPI);\n      unsubscribeFromEvents();\n    },\n\n    /**\n     * Uniformly sets color to all loaded grid layer.\n     */\n    set lineColor(color) {\n      layers.forEach(layer => {\n        layer.color = color;\n      });\n      lastLineColor = tinycolor(color);\n      bus.fire('line-color', lastLineColor);\n      sceneAPI.fire('line-color', lastLineColor);\n    },\n\n    get lineColor() {\n      let firstLayer = queryLayer();\n      return (firstLayer && firstLayer.color) || lastLineColor;\n    },\n\n    /**\n     * Sets the background color of the scene\n     */\n    set background(rawColor) {\n      backgroundColor = tinycolor(rawColor);\n      let c = backgroundColor.toRgb();\n      scene.setClearColor(c.r/0xff, c.g/0xff, c.b/0xff, c.a);\n      scene.renderFrame();\n      bus.fire('background-color', backgroundColor);\n      sceneAPI.fire('background-color', backgroundColor);\n    },\n\n    get background() {\n      return backgroundColor;\n    },\n\n    add,\n\n    /**\n     * Executes an OverPass query and loads results into scene.\n     */\n    load,\n\n    saveToPNG,\n\n    saveToSVG\n  };\n\n  return eventify(sceneAPI); // Public bit is over. Below are just implementation details.\n\n  /**\n   * Experimental API. Can be changed/removed at any point.\n   */\n  function load(queryFilter, rawOptions) {\n    let options = LoadOptions.parse(sceneAPI, queryFilter, rawOptions);\n\n    let layer = new GridLayer();\n    layer.id = options.place;\n\n    // TODO: Cancellation logic?\n    Query.runFromOptions(options).then(grid => {\n      grid.setProjector(options.projector);\n      layer.setGrid(grid);\n    }).catch(e => {\n      console.error(`Could not execute:\n  ${queryFilter}\n  The error was:`);\n      console.error(e);\n      layer.destroy();\n    });\n  \n    add(layer);\n    return layer;\n  }\n\n  function queryLayerAll(filter) {\n    if (!filter) return layers;\n\n    return layers.filter(layer => {\n      return layer.id === filter;\n    });\n  }\n\n  function queryLayer(filter) {\n    let result = queryLayerAll(filter);\n    if (result) return result[0];\n  }\n\n  function add(gridLayer) {\n    if (layers.indexOf(gridLayer) > -1) return; // O(n).\n\n    gridLayer.bindToScene(scene);\n    layers.push(gridLayer);\n\n    if (layers.length === 1) {\n      // TODO: Should I do this for other layers?\n      let viewBox = gridLayer.getViewBox();\n      if (viewBox) {\n        scene.setViewBox(viewBox);\n      }\n    }\n  }\n\n  function saveToPNG(name) {\n    return toPNG(sceneAPI, {name});\n  }\n\n  function saveToSVG(name, options) {\n    return toSVG(sceneAPI, Object.assign({}, {name}, options));\n  }\n\n  function triggerTransform(t) {\n    bus.fire('scene-transform');\n  }\n\n  function triggerAdd(e) {\n    sceneAPI.fire('layer-added', e);\n  }\n\n  function triggerRemove(e) {\n    sceneAPI.fire('layer-removed', e);\n  }\n\n  function listenToEvents() {\n    document.addEventListener('keydown', onKeyDown, true);\n    document.addEventListener('keyup', onKeyUp, true);\n  }\n\n  function unsubscribeFromEvents() {\n    document.removeEventListener('keydown', onKeyDown, true);\n    document.removeEventListener('keyup', onKeyUp, true);\n  }\n\n  function onKeyDown(e) {\n    if (e.shiftKey) {\n      slowDownZoom = true;\n      if (camera.setSpeed) camera.setSpeed(0.1);\n    } \n  }\n\n  function onKeyUp(e) {\n    if (!e.shiftKey && slowDownZoom) {\n      if (camera.setSpeed) camera.setSpeed(1);\n      slowDownZoom = false;\n    }\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/createScene.js","import request from './request';\nimport Progress from './Progress';\n\nlet imageUrl = 'https://edi6jgnosf.execute-api.us-west-2.amazonaws.com/Stage/put_image'\n\nconst productKinds = {\n  mug: '168739066664861503'\n};\n\nfunction getZazzleLink(kind, imageUrl) {\n  const productCode = productKinds[kind];\n  if (!productCode) {\n    throw new Error('Unknown product kind: ' + kind);\n  }\n\n  const imageEncoded = encodeURIComponent(imageUrl);\n  return `https://www.zazzle.com/api/create/at-238058511445368984?rf=238058511445368984&ax=Linkover&pd=${productCode}&ed=true&tc=&ic=&t_map_iid=${imageEncoded}`;\n}\n\nexport default function generateZazzleLink(canvas) {\n  var imageContent = canvas.toDataURL('image/png').replace(/^data:image\\/(png|jpg);base64,/, '');\n  const form = new FormData();\n  form.append('image', imageContent);\n\n  return request(imageUrl, {\n    method: 'POST',\n    responseType: 'json',\n    progress: new Progress(Function.prototype),\n    body: form,\n  }, 'POST').then(x => {\n    if (!x.success) throw new Error('Failed to upload image');\n    let link = x.data.link; \n    return getZazzleLink('mug', link);\n  }).catch(e => {\n    console.log('error', e);\n    throw e;\n  });\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/getZazzleLink.js","export default function createOverlayManager() {\n  let overlay;\n  let downEvent = {\n    clickedElement: null,\n    x: 0,\n    y: 0,\n    time: Date.now(),\n    left: 0,\n    right: 0\n  };\n\n  document.addEventListener('mousedown', handleMouseDown);\n  document.addEventListener('mouseup', handleMouseUp);\n  document.addEventListener('touchstart', handleTouchStart, {passive: false, capture: true});\n  document.addEventListener('touchend', handleTouchEnd, true);\n  document.addEventListener('touchcancel', handleTouchEnd, true);\n\n  return {\n    track,\n    dispose,\n    clear\n  }\n\n  function clear() {\n    const activeOverlays = document.querySelectorAll('.overlay-active');\n    for (let i = 0; i < activeOverlays.length; ++i) {\n      deselect(activeOverlays[i]);\n    }\n  }\n\n  function handleMouseDown(e) {\n    onPointerDown(e.clientX, e.clientY, e);\n  }\n\n  function handleMouseMove(e) {\n    onPointerMove(e.clientX, e.clientY);\n  }\n\n  function handleMouseUp(e) {\n    onPointerUp(e.clientX, e.clientY)\n  }\n\n  function handleTouchStart(e) {\n    if (e.touches.length > 1) return;\n\n    let touch = e.touches[0];\n    onPointerDown(touch.clientX, touch.clientY, e);\n  }\n\n  function handleTouchEnd(e) {\n    if (e.changedTouches.length > 1) return;\n    let touch = e.changedTouches[0];\n    let gotSomethingSelected = onPointerUp(touch.clientX, touch.clientY);\n    if (gotSomethingSelected) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  }\n\n  function handleTouchMove(e) {\n    if (e.touches.length > 1) return;\n    let touch = e.touches[0];\n    onPointerMove(touch.clientX, touch.clientY);\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  function onPointerDown(x, y, e) {\n    let foundElement = findTrackedElementUnderCursor(x, y)\n    let activeOverlays = document.querySelectorAll('.overlay-active');\n\n    for (let i = 0; i < activeOverlays.length; ++i) {\n      let el = activeOverlays[i];\n      if (el !== foundElement) deselect(el);\n    }\n    if (activeOverlays.length === 1) downEvent.clickedElement = activeOverlays[0];\n\n    let secondTimeClicking = foundElement && foundElement === downEvent.clickedElement;\n    if (secondTimeClicking) {\n      if (!downEvent.clickedElement.contains(e.target)) {\n        foundElement = null;\n        secondTimeClicking = false;\n      }\n    }\n    let shouldAddOverlay = secondTimeClicking && !foundElement.classList.contains('exclusive');\n    if (shouldAddOverlay) {\n      // prepare for move!\n      addDragOverlay();\n      e.preventDefault();\n      e.stopPropagation();\n    } else {\n      downEvent.clickedElement = foundElement;\n    }\n\n    downEvent.x = x;\n    downEvent.y = y;\n    downEvent.time = Date.now();\n    if (foundElement) {\n      let bBox = foundElement.getBoundingClientRect();\n      downEvent.dx = bBox.right - downEvent.x; \n      downEvent.dy = bBox.bottom - downEvent.y;\n    } else {\n      clear();\n    }\n  }\n\n  function onPointerUp(x, y) {\n    if (!downEvent.clickedElement) return;\n    removeOverlay();\n\n    if (isSingleClick(x, y)) {\n      // forward focus, we didn't move the element\n      select(downEvent.clickedElement, x, y);\n      return true;\n    } else {\n      downEvent.clickedElement = null;\n    }\n  }\n\n  function onPointerMove(x, y) {\n    if (!downEvent.clickedElement) return;\n\n    let style = downEvent.clickedElement.style;\n    style.right = 100*(window.innerWidth - x - downEvent.dx)/window.innerWidth + '%';\n    style.bottom = 100*(window.innerHeight - y - downEvent.dy)/window.innerHeight + '%';\n  }\n\n  function addDragOverlay() {\n    removeOverlay();\n\n    overlay = document.createElement('div');\n    overlay.classList.add('drag-overlay');\n    document.body.appendChild(overlay);\n\n    document.addEventListener('mousemove', handleMouseMove, true);\n    document.addEventListener('touchmove', handleTouchMove, {passive: false, capture: true});\n  }\n\n  function removeOverlay() {\n    if (overlay) {\n      document.body.removeChild(overlay);\n      overlay = null;\n    }\n\n    document.removeEventListener('mousemove', handleMouseMove, true);\n    document.removeEventListener('touchmove', handleTouchMove, {passive: false, capture: true});\n  }\n\n  function isSingleClick(x, y) {\n    let timeDiff = Date.now() - downEvent.time;\n    if (timeDiff > 300) return false; // took too long for a single click;\n\n    // should release roughly in the same place where pressed:\n    return Math.hypot(x - downEvent.x, y - downEvent.y) < 40; \n  }\n\n  function findTrackedElementUnderCursor(x, y) {\n    let autoTrack = document.querySelectorAll('.can-drag');\n    for (let i = 0; i < autoTrack.length; ++i) {\n      let el = autoTrack[i];\n      let rect = getRectangle(el);\n      if (intersects(x, y, rect)) return el;\n    }\n  }\n\n  function deselect(el) {\n    el.style.pointerEvents = 'none';\n    el.classList.remove('overlay-active');\n    el.classList.remove('exclusive')\n  }\n\n  function select(el, x, y) {\n    if (!el) return;\n\n    el.style.pointerEvents = '';\n\n    if (el.classList.contains('overlay-active')) {\n      // When they click second time, we want to forward focus to the element\n      // (if they support focus forwarding)\n      if (el.receiveFocus) el.receiveFocus();\n      // and make the element exclusive owner of the mouse/pointer\n      // (so that native interaction can occur and we don't interfere with dragging)\n      el.classList.add('exclusive')\n    } else {\n      // When they click first time, we enter to \"drag around\" mode\n      el.classList.add('overlay-active');\n      if (el.classList.contains('can-resize')) {\n        // el.resizer = renderResizeHandlers(el);\n      }\n    }\n  }\n\n\n  function intersects(x, y, rect) {\n    return !(x < rect.left || x > rect.right || y < rect.top || y > rect.bottom);\n  }\n\n  function getRectangle(x) {\n    return x.getBoundingClientRect();\n  }\n\n  function track(domElement, options) {\n    domElement.style.pointerEvents = 'none'\n    domElement.classList.add('can-drag');\n\n    if (options) {\n      if (options.receiveFocus) domElement.receiveFocus = options.receiveFocus;\n    }\n  }\n\n  function dispose() {\n    document.removeEventListener('mousedown', handleMouseDown);\n    document.removeEventListener('mouseup', handleMouseUp);\n    document.removeEventListener('touchstart', handleTouchStart);\n    document.removeEventListener('touchend', handleTouchEnd);\n    document.removeEventListener('touchcancel', handleTouchEnd);\n    downEvent.clickedElement = undefined;\n    removeOverlay();\n  }\n}\n\nfunction renderResizeHandlers(el) {\n  el.getBoundingClientRect(el)\n}\n\n\n// WEBPACK FOOTER //\n// ./src/createOverlayManager.js","<template>\n<div>\n  <find-place v-if='!placeFound' @loaded='onGridLoaded'></find-place>\n  <div id=\"app\">\n    <div v-if='placeFound'>\n      <div class='controls'>\n        <a href=\"#\" class='print-button' @click.prevent='toggleSettings'>Customize...</a>\n        <a href=\"#\" class='try-another' @click.prevent='startOver'>Try another city</a>\n      </div>\n      <div v-if='showSettings' class='print-window'>\n        <h3>Display</h3>\n        <div class='row'>\n          <div class='col'>Colors</div>\n          <div class='col colors c-2'>\n            <div v-for='layer in layers' :key='layer.name' class='color-container'>\n              <color-picker v-model='layer.color' @change='layer.changeColor'></color-picker>\n              <div class='color-label'>{{layer.name}}</div>\n            </div>\n          </div>\n        </div>\n\n        <h3>Export</h3>\n        <div class='row'>\n          <a href='#' @click.prevent='zazzleMugPrint()' class='col'>Onto a mug</a> \n          <span class='col c-2'>\n            Print what you see onto a mug. <br/>Get a unique gift of your favorite city.\n          </span>\n        </div>\n        <div class='preview-actions message' v-if='zazzleLink || generatingPreview'>\n            <div v-if='zazzleLink' class='padded popup-help'>\n              If your browser has blocked the new window, <br/>please <a :href='zazzleLink' target='_blank'>click here</a>\n              to open it.\n            </div>\n            <div v-if='generatingPreview' class='loading-container'>\n              <loading-icon></loading-icon>\n              Generating preview url...\n            </div>\n        </div>\n        <div class='row'>\n          <a href='#'  @click.prevent='toPNGFile' class='col'>As an image (.png)</a> \n          <span class='col c-2'>\n            Save the current screen as a raster image.\n          </span>\n        </div>\n        \n        <div class='row'>\n          <a href='#'  @click.prevent='toSVGFile' class='col'>As a vector (.svg)</a> \n          <span class='col c-2'>\n            Save the current screen as a vector image.\n          </span>\n        </div>\n        <div v-if='false' class='row'>\n          <a href='#' @click.prevent='toProtobuf' class='col'>To a .PBF file</a> \n          <span class='col c-2'>\n            Save the current data as a protobuf message. For developer use only.\n          </span>\n        </div>\n\n        <h3>About</h3>\n        <div>\n          <p>This website was created by <a href='https://twitter.com/anvaka' target='_blank'>@anvaka</a>.\n          It downloads roads from OpenStreetMap and renders them with WebGL.\n          </p>\n          <p>\n           You can find the entire <a href='https://github.com/anvaka/city-roads'>source code here</a>. \n           If you love this website you can also <a href='https://www.paypal.com/paypalme2/anvakos/3'>buy me a coffee</a>, but you don't have to!\n          </p>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <editable-label v-if='placeFound' v-model='name' class='city-name' :printable='true' :style='{color: labelColorRGBA}' :overlay-manager='overlayManager'></editable-label>\n  <div v-if='placeFound' class='license printable can-drag' :style='{color: labelColorRGBA}'>data <a href='https://www.openstreetmap.org/about/' target=\"_blank\" :style='{color: labelColorRGBA}'>© OpenStreetMap</a></div>\n  </div>\n</template>\n\n<script>\nimport FindPlace from './components/FindPlace';\nimport LoadingIcon from './components/LoadingIcon';\nimport EditableLabel from './components/EditableLabel';\nimport ColorPicker from './components/ColorPicker';\nimport createScene from './lib/createScene';\nimport GridLayer from './lib/GridLayer';\nimport generateZazzleLink from './lib/getZazzleLink';\nimport appState from './lib/appState';\nimport {getPrintableCanvas, getCanvas} from './lib/saveFile';\nimport config from './config';\nimport './lib/canvas2BlobPolyfill';\nimport bus from './lib/bus';\nimport createOverlayManager from './createOverlayManager';\nimport tinycolor from 'tinycolor2';\n\nclass ColorLayer {\n  constructor(name, color, callback) {\n    this.name = name;\n    this.changeColor = callback;\n    this.color = color;\n  }\n}\n\nexport default {\n  name: 'App',\n  components: {\n    FindPlace,\n    LoadingIcon,\n    EditableLabel,\n    ColorPicker\n  },\n  data() {\n    return {\n      placeFound: false,\n      name: '',\n      zazzleLink: null,\n      generatingPreview: false,\n      showSettings: false,\n      settingsOpen: false,\n      labelColor: config.getLabelColor().toRgb(),\n      backgroundColor: config.getBackgroundColor().toRgb(),\n      layers: []\n    }\n  },\n  computed: {\n    labelColorRGBA() {\n      return toRGBA(this.labelColor);\n    }\n  },\n  created() {\n    bus.on('scene-transform', this.handleSceneTransform);\n    bus.on('background-color', this.syncBackground);\n    bus.on('line-color', this.syncLineColor);\n    this.overlayManager = createOverlayManager();\n  },\n  beforeDestroy() {\n    this.overlayManager.dispose();\n    this.dispose();\n    bus.off('scene-transform', this.handleSceneTransform);\n    bus.off('background-color', this.syncBackground);\n    bus.off('line-color', this.syncLineColor);\n  },\n  methods: {\n    dispose() {\n      if (this.scene) {\n        this.scene.dispose();\n        window.scene = null;\n      }\n    },\n    toggleSettings() {\n      this.showSettings = !this.showSettings;\n    },\n    handleSceneTransform() {\n      this.zazzleLink = null;\n    },\n    onGridLoaded(grid) {\n      if (grid.isArea) {\n        appState.set('areaId', grid.id);\n        appState.unset('osm_id');\n        appState.unset('bbox');\n      } else if (grid.bboxString) {\n        appState.unset('areaId');\n        appState.set('osm_id', grid.id);\n        appState.set('bbox', grid.bboxString);\n      }\n      this.placeFound = true;\n      this.name = grid.name.split(',')[0];\n      let canvas = getCanvas();\n      canvas.style.visibility = 'visible';\n\n      this.scene = createScene(canvas);\n      this.scene.on('layer-added', this.updateLayers);\n      this.scene.on('layer-removed', this.updateLayers);\n\n      window.scene = this.scene;\n\n      let gridLayer = new GridLayer();\n      gridLayer.id = 'lines';\n      gridLayer.setGrid(grid);\n      this.scene.add(gridLayer)\n    },\n\n    startOver() {\n      appState.unset('areaId');\n      appState.unsetPlace();\n      appState.unset('q');\n      appState.enableCache();\n\n      this.dispose();\n      this.placeFound = false;\n      this.zazzleLink = null;\n      this.showSettings = false;\n      this.backgroundColor = config.getBackgroundColor().toRgb();\n      this.labelColor = config.getLabelColor().toRgb();\n\n      document.body.style.backgroundColor = config.getBackgroundColor().toRgbString();\n      getCanvas().style.visibility = 'hidden';\n    },\n\n    toPNGFile(e) {\n      scene.saveToPNG(this.name)\n    },\n\n    toSVGFile(e) { \n      scene.saveToSVG(this.name)\n    },\n\n    updateLayers() {\n      // TODO: This method likely doesn't belong here\n      let newLayers = [];\n      let lastLayer = 0;\n      let renderer = this.scene.getRenderer();\n      let root = renderer.getRoot();\n      root.children.forEach(layer => {\n        if (!layer.color) return;\n        let name = layer.id;\n        if (!name) {\n          lastLayer += 1;\n          name = 'lines ' + lastLayer;\n        }\n        let layerColor = tinycolor.fromRatio(layer.color);\n        newLayers.push(new ColorLayer(name, layerColor, newColor => {\n          this.zazzleLink = null;\n          layer.color = toRatioColor(newColor);\n          renderer.renderFrame();\n          this.scene.fire('color-change', layer);\n        }));\n      });\n\n      newLayers.push(\n        new ColorLayer('background', this.backgroundColor, this.setBackgroundColor),\n        new ColorLayer('labels', this.labelColor, newColor => this.labelColor = newColor)\n      );\n\n      this.layers = newLayers;\n\n      function toRatioColor(c) {\n        return {r: c.r/0xff, g: c.g/0xff, b: c.b/0xff, a: c.a}\n      }\n      this.zazzleLink = null;\n    },\n\n    syncLineColor() {\n      this.updateLayers();\n    },\n\n    syncBackground(newBackground) {\n      this.backgroundColor = newBackground.toRgb();\n      this.updateLayers()\n    },\n    // TODO: I need two background methods?\n    updateBackground() {\n      this.setBackgroundColor(this.backgroundColor)\n      this.zazzleLink = null;\n    },\n    setBackgroundColor(c) {\n      this.scene.background = c;\n      document.body.style.backgroundColor = toRGBA(c);\n      this.zazzleLink = null;\n    },\n\n    zazzleMugPrint() {\n      if (this.zazzleLink) {\n        window.open(this.zazzleLink, '_blank');\n        recordOpenClick(this.zazzleLink);\n        return;\n      }\n\n      this.generatingPreview = true;\n      getPrintableCanvas(this.scene).then(printableCanvas => {\n        generateZazzleLink(printableCanvas).then(link => {\n          this.zazzleLink = link;\n          window.open(link, '_blank');\n          recordOpenClick(link);\n          this.generatingPreview = false;\n        }).catch(e => {\n          this.error = e;\n          this.generatingPreview = false;\n        });\n      });\n    }\n  }\n}\n\nfunction toRGBA(c) {\n    return `rgba(${c.r}, ${c.g}, ${c.b}, ${c.a})`;\n}\n\nfunction recordOpenClick(link) {\n  if (typeof ga === 'undefined') return;\n\n  ga('send', 'event', {\n      eventCategory: 'Outbound Link',\n      eventAction: 'click',\n      eventLabel: link\n    });\n}\n</script>\n\n<style lang='stylus'>\n@import('./vars.styl');\n\n#app {\n  margin: 8px;\n  max-height: 100vh;\n  position: absolute;\n  z-index: 1;\n  h3 {\n    font-weight: normal;\n  }\n}\n\n.can-drag {\n  border: 1px solid transparent;\n}\n\n.drag-overlay {\n  position: fixed;\n  background: transparent;\n  left: 0;\n  top: 0;\n  right: 0;\n  bottom: 0;\n}\n\n.overlay-active {\n  border: 1px dashed highlight-color;\n}\n.overlay-active.exclusive {\n  border-style: solid;\n}\n\n.controls {\n  height: 48px;\n  background: white;\n  display: flex;\n  flex-direction: row;\n  align-items: stretch;\n  width: desktop-controls-width;\n  justify-content: space-around;\n  box-shadow: 0 2px 4px rgba(0,0,0,0.2), 0 -1px 0px rgba(0,0,0,0.02);\n\n  a {\n    text-decoration: none;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    color: highlight-color;\n    margin: 0;\n    border: 0;\n    &:hover {\n      color: emphasis-background;\n      background: highlight-color;\n    }\n  }\n  a.try-another {\n    flex: 1;\n  }\n\n  a.print-button {\n    flex: 1;\n    border-right: 1px solid border-color;\n    &:focus {\n      border: 1px dashed highlight-color;\n    }\n  }\n}\n\n.col {\n    display: flex;\n    flex: 1;\n    select {\n      margin-left: 14px;\n    }\n  }\n.row {\n  margin-top: 4px;\n  display: flex;\n  flex-direction: row;\n  min-height: 32px;\n}\n.colors {\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n\n  .color-container {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    width: 64px;\n  }\n\n  .color-label {\n    font-size: 12px;\n  }\n}\n\na {\n  border: 1px solid transparent;\n  margin: -1px;\n  text-decoration: none;\n  color: highlight-color\n}\na:focus {\n  border: 1px dashed highlight-color;\n  outline: none;\n}\n.print-window {\n  max-height: calc(100vh - 48px);\n  overflow-y: auto;\n  border-top: 1px solid border-color;\n  background: white;\n  box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n  width: desktop-controls-width;\n  padding: 8px;\n  .row a {\n    margin-right: 4px;\n  }\n\n  h3 {\n    margin: 8px 0;\n    text-align: right;\n  }\n}\n\n.message {\n  border-top: 1px solid border-color\n  border-bottom: 1px solid border-color\n  background: #F5F5F5;\n}\n\n.preview-actions {\n  display: flex;\n  padding: 8px 0;\n  margin-left: -8px;\n  margin-bottom: 14px;\n  margin-top: 1px;\n  width: desktop-controls-width;\n  flex-direction: column;\n  align-items: stretch;\n  font-size: 14px;\n  align-items: center;\n  display: flex;\n\n  .popup-help {\n    text-align: center;\n  }\n}\n\n.city-name {\n  position: absolute;\n  right: 32px;\n  bottom: 54px;\n  font-size: 24px;\n  color: #434343;\n  input {\n    font-size: 24px;\n  }\n}\n\n.license {\n  text-align: right;\n  position: fixed;\n  font-family: labels-font;\n  right: 32px;\n  bottom: 32px;\n  font-size: 12px;\n  padding-right: 8px;\n  a {\n    text-decoration: none;\n    display: inline-block;\n  }\n}\n\n.c-2 {\n  flex: 2\n}\n\n@media (max-width: small-screen) {\n  #app {\n    width: 100%;\n    margin: 0;\n\n    .preview-actions,.error,\n    .controls, .print-window {\n      width: 100%;\n    }\n    .loading-container {\n      font-size: 12px;\n    }\n\n    .print-window {\n      font-size: 14px;\n    }\n\n  }\n  .city-name  {\n    right: 8px;\n    bottom: 24px;\n  }\n  .license  {\n    right: 8px;\n    bottom: 8px;\n  }\n}\n\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/App.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[(!_vm.placeFound)?_c('find-place',{on:{\"loaded\":_vm.onGridLoaded}}):_vm._e(),_vm._v(\" \"),_c('div',{attrs:{\"id\":\"app\"}},[(_vm.placeFound)?_c('div',[_c('div',{staticClass:\"controls\"},[_c('a',{staticClass:\"print-button\",attrs:{\"href\":\"#\"},on:{\"click\":function($event){$event.preventDefault();return _vm.toggleSettings($event)}}},[_vm._v(\"Customize...\")]),_vm._v(\" \"),_c('a',{staticClass:\"try-another\",attrs:{\"href\":\"#\"},on:{\"click\":function($event){$event.preventDefault();return _vm.startOver($event)}}},[_vm._v(\"Try another city\")])]),_vm._v(\" \"),(_vm.showSettings)?_c('div',{staticClass:\"print-window\"},[_c('h3',[_vm._v(\"Display\")]),_vm._v(\" \"),_c('div',{staticClass:\"row\"},[_c('div',{staticClass:\"col\"},[_vm._v(\"Colors\")]),_vm._v(\" \"),_c('div',{staticClass:\"col colors c-2\"},_vm._l((_vm.layers),function(layer){return _c('div',{key:layer.name,staticClass:\"color-container\"},[_c('color-picker',{on:{\"change\":layer.changeColor},model:{value:(layer.color),callback:function ($$v) {_vm.$set(layer, \"color\", $$v)},expression:\"layer.color\"}}),_vm._v(\" \"),_c('div',{staticClass:\"color-label\"},[_vm._v(_vm._s(layer.name))])],1)}),0)]),_vm._v(\" \"),_c('h3',[_vm._v(\"Export\")]),_vm._v(\" \"),_c('div',{staticClass:\"row\"},[_c('a',{staticClass:\"col\",attrs:{\"href\":\"#\"},on:{\"click\":function($event){$event.preventDefault();return _vm.zazzleMugPrint()}}},[_vm._v(\"Onto a mug\")]),_vm._v(\" \"),_vm._m(0)]),_vm._v(\" \"),(_vm.zazzleLink || _vm.generatingPreview)?_c('div',{staticClass:\"preview-actions message\"},[(_vm.zazzleLink)?_c('div',{staticClass:\"padded popup-help\"},[_vm._v(\"\\n              If your browser has blocked the new window, \"),_c('br'),_vm._v(\"please \"),_c('a',{attrs:{\"href\":_vm.zazzleLink,\"target\":\"_blank\"}},[_vm._v(\"click here\")]),_vm._v(\"\\n              to open it.\\n            \")]):_vm._e(),_vm._v(\" \"),(_vm.generatingPreview)?_c('div',{staticClass:\"loading-container\"},[_c('loading-icon'),_vm._v(\"\\n              Generating preview url...\\n            \")],1):_vm._e()]):_vm._e(),_vm._v(\" \"),_c('div',{staticClass:\"row\"},[_c('a',{staticClass:\"col\",attrs:{\"href\":\"#\"},on:{\"click\":function($event){$event.preventDefault();return _vm.toPNGFile($event)}}},[_vm._v(\"As an image (.png)\")]),_vm._v(\" \"),_c('span',{staticClass:\"col c-2\"},[_vm._v(\"\\n            Save the current screen as a raster image.\\n          \")])]),_vm._v(\" \"),_c('div',{staticClass:\"row\"},[_c('a',{staticClass:\"col\",attrs:{\"href\":\"#\"},on:{\"click\":function($event){$event.preventDefault();return _vm.toSVGFile($event)}}},[_vm._v(\"As a vector (.svg)\")]),_vm._v(\" \"),_c('span',{staticClass:\"col c-2\"},[_vm._v(\"\\n            Save the current screen as a vector image.\\n          \")])]),_vm._v(\" \"),(false)?_c('div',{staticClass:\"row\"},[_c('a',{staticClass:\"col\",attrs:{\"href\":\"#\"},on:{\"click\":function($event){$event.preventDefault();return _vm.toProtobuf($event)}}},[_vm._v(\"To a .PBF file\")]),_vm._v(\" \"),_c('span',{staticClass:\"col c-2\"},[_vm._v(\"\\n            Save the current data as a protobuf message. For developer use only.\\n          \")])]):_vm._e(),_vm._v(\" \"),_c('h3',[_vm._v(\"About\")]),_vm._v(\" \"),_vm._m(1)]):_vm._e()]):_vm._e()]),_vm._v(\" \"),(_vm.placeFound)?_c('editable-label',{staticClass:\"city-name\",style:({color: _vm.labelColorRGBA}),attrs:{\"printable\":true,\"overlay-manager\":_vm.overlayManager},model:{value:(_vm.name),callback:function ($$v) {_vm.name=$$v},expression:\"name\"}}):_vm._e(),_vm._v(\" \"),(_vm.placeFound)?_c('div',{staticClass:\"license printable can-drag\",style:({color: _vm.labelColorRGBA})},[_vm._v(\"data \"),_c('a',{style:({color: _vm.labelColorRGBA}),attrs:{\"href\":\"https://www.openstreetmap.org/about/\",\"target\":\"_blank\"}},[_vm._v(\"© OpenStreetMap\")])]):_vm._e()],1)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('span',{staticClass:\"col c-2\"},[_vm._v(\"\\n            Print what you see onto a mug. \"),_c('br'),_vm._v(\"Get a unique gift of your favorite city.\\n          \")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('p',[_vm._v(\"This website was created by \"),_c('a',{attrs:{\"href\":\"https://twitter.com/anvaka\",\"target\":\"_blank\"}},[_vm._v(\"@anvaka\")]),_vm._v(\".\\n          It downloads roads from OpenStreetMap and renders them with WebGL.\\n          \")]),_vm._v(\" \"),_c('p',[_vm._v(\"\\n           You can find the entire \"),_c('a',{attrs:{\"href\":\"https://github.com/anvaka/city-roads\"}},[_vm._v(\"source code here\")]),_vm._v(\". \\n           If you love this website you can also \"),_c('a',{attrs:{\"href\":\"https://www.paypal.com/paypalme2/anvakos/3\"}},[_vm._v(\"buy me a coffee\")]),_vm._v(\", but you don't have to!\\n          \")])])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-b539f1dc\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/App.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-b539f1dc\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!stylus-loader?{\\\"sourceMap\\\":true}!../node_modules/vue-loader/lib/selector?type=styles&index=0!./App.vue\")\n}\nvar normalizeComponent = require(\"!../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../node_modules/vue-loader/lib/selector?type=script&index=0!./App.vue\"\nimport __vue_script__ from \"!!babel-loader!../node_modules/vue-loader/lib/selector?type=script&index=0!./App.vue\"\n/* template */\nimport __vue_template__ from \"!!../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-b539f1dc\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../node_modules/vue-loader/lib/selector?type=template&index=0!./App.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/App.vue\n// module id = null\n// module chunks = ","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _vm._m(0)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"absolute no-webgl\"},[_c('h3',[_vm._v(\"WebGL is not enabled :(\")]),_vm._v(\" \"),_c('p',[_vm._v(\"This website renders millions of roads at once.\")]),_vm._v(\" \"),_c('p',[_vm._v(\"\\n    To render this amount of data fast, the website uses \"),_c('a',{attrs:{\"href\":\"https://get.webgl.org/\"}},[_vm._v(\"WebGL\")]),_vm._v(\",\\n    which seem to be not supported by the device that you are using.\\n  \")]),_vm._v(\" \"),_c('p',[_vm._v(\"Please try a different device to play with this website\")]),_vm._v(\" \"),_c('img',{attrs:{\"src\":\"https://i.imgur.com/Fbbe5a6.png\",\"alt\":\"demo\"}})])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-4c133b01\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/NoWebGL.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-4c133b01\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!stylus-loader?{\\\"sourceMap\\\":true}!../node_modules/vue-loader/lib/selector?type=styles&index=0!./NoWebGL.vue\")\n}\nvar normalizeComponent = require(\"!../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nvar __vue_script__ = null\n/* template */\nimport __vue_template__ from \"!!../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-4c133b01\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../node_modules/vue-loader/lib/selector?type=template&index=0!./NoWebGL.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-4c133b01\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/NoWebGL.vue\n// module id = null\n// module chunks = ","// The Vue build version to load with the `import` command\n// (runtime-only or standalone) has been set in webpack.base.conf with an alias.\nimport Vue from 'vue';\nimport App from './App';\nimport NoWebGL from './NoWebGL';\nimport Query from './lib/Query';\nimport {require as d3Require} from 'd3-require';\n\nconst wgl = require('w-gl');\n\nwindow.addEventListener('error', logError);\n\nVue.config.productionTip = false\n\n// expose the console API\nwindow.requireModule = d3Require;\nwindow.Query = Query;\n\nif (wgl.isWebGLEnabled(document.querySelector('#canvas'))) {\n  /* eslint-disable no-new */\n  new Vue({\n    el: '#app',\n    components: { App },\n    template: '<App/>'\n  })\n} else {\n  new Vue({\n    el: '#app',\n    components: { NoWebGL },\n    template: '<NoWebGL/>'\n  })\n}\n\nfunction logError(e) {\n  if (typeof ga !== 'function') return;\n\n  const exDescription = e ? `${e.message} in ${e.filename}:${e.lineno}` : 'Unknown exception';\n\n  ga('send', 'exception', {\n    exDescription,\n    exFatal: false\n  });\n}\n\n\n// WEBPACK FOOTER //\n// ./src/main.js","/*\n * JavaScript Canvas to Blob\n * https://github.com/blueimp/JavaScript-Canvas-to-Blob\n *\n * Copyright 2012, Sebastian Tschan\n * https://blueimp.net\n *\n * Licensed under the MIT license:\n * https://opensource.org/licenses/MIT\n *\n * Based on stackoverflow user Stoive's code snippet:\n * http://stackoverflow.com/q/4998908\n */\n\n/* global define, Uint8Array, ArrayBuffer, module */\n\n;(function(window) {\n  'use strict'\n\n  var CanvasPrototype =\n    window.HTMLCanvasElement && window.HTMLCanvasElement.prototype\n  var hasBlobConstructor =\n    window.Blob &&\n    (function() {\n      try {\n        return Boolean(new Blob())\n      } catch (e) {\n        return false\n      }\n    })()\n  var hasArrayBufferViewSupport =\n    hasBlobConstructor &&\n    window.Uint8Array &&\n    (function() {\n      try {\n        return new Blob([new Uint8Array(100)]).size === 100\n      } catch (e) {\n        return false\n      }\n    })()\n  var BlobBuilder =\n    window.BlobBuilder ||\n    window.WebKitBlobBuilder ||\n    window.MozBlobBuilder ||\n    window.MSBlobBuilder\n  var dataURIPattern = /^data:((.*?)(;charset=.*?)?)(;base64)?,/\n  var dataURLtoBlob =\n    (hasBlobConstructor || BlobBuilder) &&\n    window.atob &&\n    window.ArrayBuffer &&\n    window.Uint8Array &&\n    function(dataURI) {\n      var matches,\n        mediaType,\n        isBase64,\n        dataString,\n        byteString,\n        arrayBuffer,\n        intArray,\n        i,\n        bb\n      // Parse the dataURI components as per RFC 2397\n      matches = dataURI.match(dataURIPattern)\n      if (!matches) {\n        throw new Error('invalid data URI')\n      }\n      // Default to text/plain;charset=US-ASCII\n      mediaType = matches[2]\n        ? matches[1]\n        : 'text/plain' + (matches[3] || ';charset=US-ASCII')\n      isBase64 = !!matches[4]\n      dataString = dataURI.slice(matches[0].length)\n      if (isBase64) {\n        // Convert base64 to raw binary data held in a string:\n        byteString = atob(dataString)\n      } else {\n        // Convert base64/URLEncoded data component to raw binary:\n        byteString = decodeURIComponent(dataString)\n      }\n      // Write the bytes of the string to an ArrayBuffer:\n      arrayBuffer = new ArrayBuffer(byteString.length)\n      intArray = new Uint8Array(arrayBuffer)\n      for (i = 0; i < byteString.length; i += 1) {\n        intArray[i] = byteString.charCodeAt(i)\n      }\n      // Write the ArrayBuffer (or ArrayBufferView) to a blob:\n      if (hasBlobConstructor) {\n        return new Blob([hasArrayBufferViewSupport ? intArray : arrayBuffer], {\n          type: mediaType\n        })\n      }\n      bb = new BlobBuilder()\n      bb.append(arrayBuffer)\n      return bb.getBlob(mediaType)\n    }\n  if (window.HTMLCanvasElement && !CanvasPrototype.toBlob) {\n    if (CanvasPrototype.mozGetAsFile) {\n      CanvasPrototype.toBlob = function(callback, type, quality) {\n        var self = this\n        setTimeout(function() {\n          if (quality && CanvasPrototype.toDataURL && dataURLtoBlob) {\n            callback(dataURLtoBlob(self.toDataURL(type, quality)))\n          } else {\n            callback(self.mozGetAsFile('blob', type))\n          }\n        })\n      }\n    } else if (CanvasPrototype.toDataURL && dataURLtoBlob) {\n      CanvasPrototype.toBlob = function(callback, type, quality) {\n        var self = this\n        setTimeout(function() {\n          callback(dataURLtoBlob(self.toDataURL(type, quality)))\n        })\n      }\n    }\n  }\n  if (typeof define === 'function' && define.amd) {\n    define(function() {\n      return dataURLtoBlob\n    })\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = dataURLtoBlob\n  } else {\n    window.dataURLtoBlob = dataURLtoBlob\n  }\n})(window)\n\n\n// WEBPACK FOOTER //\n// ./src/lib/canvas2BlobPolyfill.js"],"sourceRoot":""}